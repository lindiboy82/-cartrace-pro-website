<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarTrace Pro - Ultimate Enhanced Dashboard v2</title>
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Leaflet for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #2196F3;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
            --dark: #111827;
            --light: #f8fafc;
            --white: #FFFFFF;
            --surface: #f3f4f6;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --nav-selected: rgba(79, 70, 229, 0.1);
            --carfax-blue: #0057B8;
            --carfax-orange: #FF6B35;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .app-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><defs><radialGradient id="globeGrad" cx="50%" cy="40%" r="70%"><stop offset="0%" style="stop-color:%23a8c8ec"/><stop offset="100%" style="stop-color:%232563eb"/></radialGradient></defs><circle cx="200" cy="220" r="140" fill="url(%23globeGrad)"/><g stroke="white" stroke-width="3" fill="none"><circle cx="200" cy="220" r="140"/><ellipse cx="200" cy="220" rx="140" ry="70"/><ellipse cx="200" cy="220" rx="70" ry="140"/><line x1="60" y1="220" x2="340" y2="220"/><line x1="200" y1="80" x2="200" y2="360"/></g><path d="M200 80 L230 160 L200 200 Z" fill="%23dc2626"/><ellipse cx="210" cy="130" rx="18" ry="18" fill="white"/><text x="200" y="35" text-anchor="middle" fill="%23111827" font-family="Arial Black" font-size="40" font-weight="bold">Car Trace</text></svg>') center/contain no-repeat;
        }

        .app-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .app-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .sync-status {
            font-size: 12px;
            color: var(--success);
            margin-top: 10px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--primary);
            color: white;
            transform: translateX(4px);
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 18px;
        }

        .notification-badge {
            background: var(--danger);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .card-icon {
            margin-right: 10px;
            font-size: 24px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .stat-trend {
            color: var(--success);
            font-size: 12px;
            margin-top: 5px;
            font-weight: 600;
        }

        /* Vehicle Cards */
        .vehicle-list {
            display: grid;
            gap: 20px;
        }

        .vehicle-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary);
            display: flex;
            gap: 20px;
            position: relative;
        }

        .vehicle-card.stolen {
            border-left-color: var(--danger);
            background: #fef2f2;
        }

        .vehicle-image {
            width: 150px;
            height: 150px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .vehicle-content {
            flex: 1;
        }

        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .vehicle-info h3 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .vehicle-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .vehicle-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-edit {
            background: var(--info);
            color: white;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        .btn-report {
            background: var(--danger);
            color: white;
        }

        .btn-gps {
            background: var(--success);
            color: white;
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            background: none;
            border: none;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Image Upload */
        .image-upload {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .image-upload:hover {
            border-color: var(--primary);
            background: #f9fafb;
        }

        .image-upload.dragover {
            border-color: var(--primary);
            background: var(--nav-selected);
        }

        .image-preview {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .preview-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }

        /* Map Styles */
        #map {
            height: 500px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .leaflet-popup-content {
            font-family: 'Segoe UI', sans-serif;
        }

        /* Protection Plans */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .plan-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }

        .plan-card:hover {
            transform: translateY(-5px);
        }

        .plan-card.featured {
            border: 3px solid var(--primary);
        }

        .plan-badge {
            position: absolute;
            top: 20px;
            right: -30px;
            background: var(--primary);
            color: white;
            padding: 5px 40px;
            transform: rotate(45deg);
            font-size: 12px;
            font-weight: bold;
        }

        .plan-name {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .plan-price {
            font-size: 36px;
            font-weight: bold;
            color: var(--text-primary);
            margin: 20px 0;
        }

        .plan-price span {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .plan-reward {
            background: #dcfce7;
            color: #166534;
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .plan-features {
            text-align: left;
            margin: 20px 0;
        }

        .plan-feature {
            padding: 10px 0;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            align-items: center;
        }

        .plan-feature:before {
            content: "‚úì";
            color: var(--success);
            font-weight: bold;
            margin-right: 10px;
        }

        /* VIN Lookup Status */
        .lookup-status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .lookup-status.loading {
            display: block;
            background: #dbeafe;
            color: #1e40af;
        }

        .lookup-status.success {
            display: block;
            background: #dcfce7;
            color: #166534;
        }

        .lookup-status.error {
            display: block;
            background: #fee2e2;
            color: #991b1b;
        }

        /* Insurance Portal */
        .insurance-login {
            max-width: 500px;
            margin: 0 auto;
        }

        /* Carfax Integration */
        .carfax-header {
            background: linear-gradient(135deg, var(--carfax-blue) 0%, var(--carfax-orange) 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        /* Live Indicator */
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 15px;
            background: #f0fdf4;
            border-radius: 8px;
            margin-top: 20px;
        }

        .live-dot {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        /* Step-by-step process */
        .step-container {
            margin-bottom: 30px;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s;
        }

        .step.active {
            display: block;
        }

        .step-header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-number {
            background: white;
            color: var(--primary);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .warning-box.danger {
            background: #fee2e2;
            border-left-color: var(--danger);
        }

        .warning-box h3 {
            color: var(--danger);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .safety-instructions {
            background: #f0fdf4;
            border-left: 4px solid var(--success);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .safety-instructions h3 {
            color: var(--success);
            margin-bottom: 15px;
        }

        .safety-instructions ul {
            margin-left: 20px;
        }

        .safety-instructions li {
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .check-result {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .check-result.stolen {
            background: #fee2e2;
            border: 2px solid var(--danger);
        }

        .check-result.not-stolen {
            background: #f0fdf4;
            border: 2px solid var(--success);
        }

        .check-result h2 {
            margin-bottom: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-label:hover {
            border-color: var(--primary);
            background: #f9fafb;
        }

        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .nav-link span:not(.nav-icon) {
                display: none;
            }
            
            .logo-section .app-title,
            .logo-section .app-subtitle,
            .sync-status {
                display: none;
            }

            .vehicle-card {
                flex-direction: column;
            }

            .vehicle-image {
                width: 100%;
                height: 200px;
            }

            .input-group {
                grid-template-columns: 1fr;
            }

            .plans-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="app-logo"></div>
                <div class="app-title">CarTrace Pro</div>
                <div class="app-subtitle">Vehicle Protection Network</div>
                <div class="sync-status" id="sync-status">‚è≥ Syncing...</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" onclick="showSection('dashboard')">
                        <span class="nav-icon">üè†</span>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('vehicles')">
                        <span class="nav-icon">üöó</span>
                        <span>My Vehicles</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('map-alerts')">
                        <span class="nav-icon">üó∫Ô∏è</span>
                        <span>Map & Alerts</span>
                        <span class="notification-badge" id="alert-badge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('protection')">
                        <span class="nav-icon">üõ°Ô∏è</span>
                        <span>Protection Plans</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('found-vehicle')">
                        <span class="nav-icon">üîç</span>
                        <span>Found Vehicle</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('insurance')">
                        <span class="nav-icon">üè¢</span>
                        <span>Insurance Portal</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('carfax')">
                        <span class="nav-icon">üìã</span>
                        <span>Carfax Integration</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('analytics')">
                        <span class="nav-icon">üìä</span>
                        <span>Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('settings')">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="signOut()">
                        <span class="nav-icon">üö™</span>
                        <span>Sign Out</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboard-section">
                <div class="header">
                    <div>
                        <h1 class="header-title">Welcome Back!</h1>
                        <p id="user-email">Loading...</p>
                    </div>
                    <div class="header-status">
                        <span class="status-dot"></span>
                        <span>Network Active</span>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üìä</span>
                        Live Network Statistics
                    </h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-icon">üöó</div>
                            <div class="stat-value" id="vehicle-count">0</div>
                            <div class="stat-label">Protected Vehicles</div>
                            <div class="stat-trend">Active protection</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-value" id="active-users">47,892</div>
                            <div class="stat-label">Community Members</div>
                            <div class="stat-trend">‚Üó +127 today</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">‚ö°</div>
                            <div class="stat-value" id="response-time">0.8</div>
                            <div class="stat-label">Response Time (ms)</div>
                            <div class="stat-trend">‚Üó Improving</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-value">96.1%</div>
                            <div class="stat-label">Recovery Rate</div>
                            <div class="stat-trend">Industry Leading</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üõ°Ô∏è</div>
                            <div class="stat-value" id="security-score">95</div>
                            <div class="stat-label">Security Score</div>
                            <div class="stat-trend">‚Üó +2 points</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üì°</div>
                            <div class="stat-value" id="network-uptime">99.97%</div>
                            <div class="stat-label">Network Uptime</div>
                            <div class="stat-trend">‚Üó +0.02%</div>
                        </div>
                    </div>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>Live updates every 3 seconds ‚Ä¢ Last update: <span id="last-update">just now</span></span>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üîî</span>
                        Recent Alerts
                    </h2>
                    <div id="recent-alerts">
                        <p style="color: var(--text-secondary); text-align: center; padding: 20px;">
                            No recent alerts in your area. Your vehicles are safe! ‚úÖ
                        </p>
                    </div>
                </div>
            </div>

            <!-- My Vehicles Section -->
            <div class="content-section" id="vehicles-section">
                <div class="header">
                    <h1 class="header-title">My Vehicles</h1>
                    <button class="btn btn-primary" onclick="openAddVehicleModal()">‚ûï Add Vehicle</button>
                </div>

                <div id="vehicles-list" class="vehicle-list">
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 20px;">üöó</div>
                        <h3 style="margin-bottom: 10px;">No Vehicles Added Yet</h3>
                        <p>Add your first vehicle to start protecting it with CarTrace Pro</p>
                        <button class="btn btn-primary" onclick="openAddVehicleModal()" style="margin-top: 20px;">Add Your First Vehicle</button>
                    </div>
                </div>
            </div>

            <!-- Map & Alerts Section -->
            <div class="content-section" id="map-alerts-section">
                <div class="header">
                    <h1 class="header-title">Map & Alerts</h1>
                    <div class="header-status">
                        <span class="status-dot"></span>
                        <span id="active-alerts-count">0</span> Active Alerts
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üó∫Ô∏è</span>
                        Live Stolen Vehicle Map
                    </h2>
                    <div id="map"></div>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        üî¥ Red markers indicate stolen vehicles reported in the last 24 hours<br>
                        üìç Click markers for more details and to report sightings
                    </p>
                </div>
            </div>

            <!-- Protection Plans Section -->
            <div class="content-section" id="protection-section">
                <div class="header">
                    <h1 class="header-title">Protection Plans</h1>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üõ°Ô∏è</span>
                        Choose Your Protection Level
                    </h2>
                    <p style="color: var(--text-secondary); margin-bottom: 30px;">
                        Select the plan that best fits your needs. All plans include 24/7 monitoring and community recovery network.
                    </p>
                    
                    <div class="plans-grid">
                        <!-- Basic Plan -->
                        <div class="plan-card">
                            <div class="plan-name">Basic</div>
                            <div class="plan-price">$17.99<span>/month</span></div>
                            <div class="plan-reward">üí∞ $200 Recovery Reward</div>
                            <div class="plan-features">
                                <div class="plan-feature">GPS Tracking</div>
                                <div class="plan-feature">Community Alerts</div>
                                <div class="plan-feature">Basic Support</div>
                                <div class="plan-feature">App Access</div>
                                <div class="plan-feature">$200 Finder Reward</div>
                            </div>
                            <button class="btn btn-primary" onclick="startCheckout('basic')">Choose Basic</button>
                        </div>

                        <!-- Gold Plan -->
                        <div class="plan-card featured">
                            <div class="plan-badge">POPULAR</div>
                            <div class="plan-name">Gold</div>
                            <div class="plan-price">$24.99<span>/month</span></div>
                            <div class="plan-reward">üí∞ $300 Recovery Reward</div>
                            <div class="plan-features">
                                <div class="plan-feature">Everything in Basic</div>
                                <div class="plan-feature">SMS Alerts</div>
                                <div class="plan-feature">Priority Support</div>
                                <div class="plan-feature">Real-time Tracking</div>
                                <div class="plan-feature">$300 Finder Reward</div>
                            </div>
                            <button class="btn btn-primary" onclick="startCheckout('gold')">Choose Gold</button>
                        </div>

                        <!-- Diamond Plan -->
                        <div class="plan-card">
                            <div class="plan-name">Diamond</div>
                            <div class="plan-price">$29.99<span>/month</span></div>
                            <div class="plan-reward">üí∞ $500 Recovery Reward</div>
                            <div class="plan-features">
                                <div class="plan-feature">Everything in Gold</div>
                                <div class="plan-feature">24/7 Support</div>
                                <div class="plan-feature">Insurance Integration</div>
                                <div class="plan-feature">Dedicated Agent</div>
                                <div class="plan-feature">$500 Finder Reward</div>
                            </div>
                            <button class="btn btn-primary" onclick="startCheckout('diamond')">Choose Diamond</button>
                        </div>

                        <!-- Platinum Plan -->
                        <div class="plan-card">
                            <div class="plan-name">Platinum</div>
                            <div class="plan-price">$35.00<span>/month</span></div>
                            <div class="plan-reward">üí∞ $750 Recovery Reward</div>
                            <div class="plan-features">
                                <div class="plan-feature">Everything in Diamond</div>
                                <div class="plan-feature">Priority Recovery</div>
                                <div class="plan-feature">Premium Support</div>
                                <div class="plan-feature">Carfax Reports</div>
                                <div class="plan-feature">Concierge Service</div>
                                <div class="plan-feature">$750 Finder Reward</div>
                            </div>
                            <button class="btn btn-primary" onclick="startCheckout('platinum')">Choose Platinum</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Found Vehicle Section - STEP-BY-STEP PROCESS -->
            <div class="content-section" id="found-vehicle-section">
                <div class="header">
                    <h1 class="header-title">Found Vehicle Reporting</h1>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üîç</span>
                        Report a Stolen Vehicle Sighting - Safety First!
                    </h2>

                    <!-- Step 1: License Plate Check -->
                    <div class="step active" id="step1">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div>
                                <h3 style="margin: 0;">Check License Plate</h3>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 14px;">Verify if the vehicle is reported stolen</p>
                            </div>
                        </div>

                        <div class="warning-box danger">
                            <h3>‚ö†Ô∏è IMPORTANT SAFETY WARNING</h3>
                            <p><strong>DO NOT approach the vehicle or put yourself in danger!</strong></p>
                            <ul style="margin: 10px 0 0 20px;">
                                <li>Maintain a safe distance from the vehicle</li>
                                <li>Do not confront anyone in or around the vehicle</li>
                                <li>Your safety is more important than any reward</li>
                            </ul>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üöó Enter License Plate Number *</label>
                            <input type="text" class="form-input" id="check-plate" placeholder="ABC1234" style="font-size: 18px; text-transform: uppercase;" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">üìç Select State *</label>
                            <select class="form-select" id="check-state">
                                <option value="">Select State</option>
                                <option value="FL">Florida</option>
                                <option value="AL">Alabama</option>
                                <option value="GA">Georgia</option>
                                <option value="TX">Texas</option>
                                <option value="CA">California</option>
                                <option value="NY">New York</option>
                            </select>
                        </div>

                        <button class="btn btn-primary" onclick="checkLicensePlate()" style="width: 100%; font-size: 16px; padding: 15px;">
                            üîç Check If Vehicle Is Stolen
                        </button>

                        <div id="plate-check-result"></div>
                    </div>

                    <!-- Step 2: Call 911 -->
                    <div class="step" id="step2">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div>
                                <h3 style="margin: 0;">Call 911 Immediately</h3>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 14px;">Report to law enforcement first</p>
                            </div>
                        </div>

                        <div class="warning-box danger">
                            <h3>üö® CRITICAL: Call 911 Now</h3>
                            <p style="font-size: 18px; font-weight: 600; margin: 15px 0;">
                                Before proceeding, you MUST call 911 and report the stolen vehicle location to police.
                            </p>
                        </div>

                        <div class="safety-instructions">
                            <h3>üìû What to Tell 911:</h3>
                            <ul>
                                <li><strong>Say:</strong> "I found a stolen vehicle"</li>
                                <li><strong>License Plate:</strong> <span id="display-plate" style="font-weight: bold;"></span></li>
                                <li><strong>Your exact location</strong> (street address or nearest intersection)</li>
                                <li><strong>Vehicle description:</strong> <span id="display-vehicle" style="font-weight: bold;"></span></li>
                                <li><strong>Your full name and callback number</strong></li>
                                <li><strong>Stay on the line</strong> and follow dispatcher instructions</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <h3>‚ö†Ô∏è Safety Reminders While on Call:</h3>
                            <ul style="margin: 10px 0 0 20px;">
                                <li>Stay at a safe distance from the vehicle</li>
                                <li>Do not approach or touch the vehicle</li>
                                <li>Stay in a well-lit, public area if possible</li>
                                <li>If you feel unsafe at any time, leave immediately</li>
                            </ul>
                        </div>

                        <div class="form-group" style="margin-top: 30px;">
                            <label class="form-label">üìù Your Full Name (as given to 911) *</label>
                            <input type="text" class="form-input" id="reporter-name" placeholder="John Smith" required />
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="called-911" required />
                                <span><strong>I confirm that I have called 911 and reported this stolen vehicle to police</strong></span>
                            </label>
                        </div>

                        <div class="input-group" style="margin-top: 20px;">
                            <button class="btn btn-secondary" onclick="goToStep(1)">‚Üê Back</button>
                            <button class="btn btn-primary" onclick="goToStep(3)" id="proceed-step3">
                                Continue After Calling 911 ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Wait for Police -->
                    <div class="step" id="step3">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div>
                                <h3 style="margin: 0;">Wait for Police Arrival</h3>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 14px;">Stay safe while officers respond</p>
                            </div>
                        </div>

                        <div class="safety-instructions">
                            <h3>üëÆ While Waiting for Police:</h3>
                            <ul>
                                <li><strong>Maintain safe distance</strong> - Stay at least 50 feet away from the vehicle</li>
                                <li><strong>Stay in a visible location</strong> - Be where police can easily find you</li>
                                <li><strong>Keep your phone accessible</strong> - In case 911 calls you back</li>
                                <li><strong>Do not approach the vehicle</strong> - Even if it appears empty</li>
                                <li><strong>If anyone approaches the vehicle</strong> - Do not intervene, call 911 again</li>
                                <li><strong>Take photos from safe distance</strong> - Only if it's safe to do so</li>
                            </ul>
                        </div>

                        <div class="warning-box danger">
                            <h3>üö® If You Feel Unsafe:</h3>
                            <p><strong>Leave the area immediately!</strong> Your safety is the priority. Police can still recover the vehicle with your initial report.</p>
                        </div>

                        <div class="form-group" style="margin-top: 30px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="police-arrived" required />
                                <span><strong>Police have arrived at the scene</strong></span>
                            </label>
                        </div>

                        <div class="input-group" style="margin-top: 20px;">
                            <button class="btn btn-secondary" onclick="goToStep(2)">‚Üê Back</button>
                            <button class="btn btn-primary" onclick="goToStep(4)" id="proceed-step4">
                                Police Arrived - Continue ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Get Police Report Number -->
                    <div class="step" id="step4">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div>
                                <h3 style="margin: 0;">Get Police Report Information</h3>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 14px;">Required for reward processing</p>
                            </div>
                        </div>

                        <div class="safety-instructions">
                            <h3>üìã When Police Arrive - Ask For:</h3>
                            <ul>
                                <li><strong>Police Report Number</strong> - They will give you a report number or case number</li>
                                <li><strong>OR Report Card</strong> - Some departments give a physical card with the report #</li>
                                <li><strong>Officer's Name and Badge Number</strong> - For verification purposes</li>
                                <li><strong>Police Department Name</strong> - Which agency responded</li>
                            </ul>
                            <p style="margin-top: 15px; padding: 15px; background: white; border-radius: 8px;">
                                <strong>üí° Tip:</strong> Tell the officer: "I need the report number for the vehicle recovery reward program"
                            </p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üìã Police Report Number / Case Number *</label>
                            <input type="text" class="form-input" id="report-number" placeholder="e.g., 2025-12345 or R-987654" required />
                            <small style="color: var(--text-secondary);">This is usually on the report card or receipt given by the officer</small>
                        </div>

                        <div class="input-group">
                            <div class="form-group">
                                <label class="form-label">üëÆ Officer's Name *</label>
                                <input type="text" class="form-input" id="officer-name" placeholder="Officer Smith" required />
                            </div>

                            <div class="form-group">
                                <label class="form-label">üî¢ Badge Number</label>
                                <input type="text" class="form-input" id="badge-number" placeholder="12345" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üè¢ Police Department *</label>
                            <input type="text" class="form-input" id="police-department" placeholder="Naples Police Department" required />
                        </div>

                        <div class="input-group" style="margin-top: 20px;">
                            <button class="btn btn-secondary" onclick="goToStep(3)">‚Üê Back</button>
                            <button class="btn btn-primary" onclick="goToStep(5)">
                                Continue to Photos ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 5: Upload Photos & Location -->
                    <div class="step" id="step5">
                        <div class="step-header">
                            <div class="step-number">5</div>
                            <div>
                                <h3 style="margin: 0;">Photo Evidence & Location</h3>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 14px;">Document the vehicle (if safe to do so)</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üì∏ Upload Photos (Up to 4)</label>
                            <div class="image-upload" id="found-image-upload">
                                <div>üì∑ Click or drag photos here</div>
                                <div style="color: var(--text-secondary); font-size: 12px; margin-top: 10px;">
                                    Clear photos of the vehicle, license plate, and location help with verification
                                </div>
                            </div>
                            <input type="file" id="found-photos" accept="image/*" multiple style="display: none;" />
                            <div id="found-image-preview" class="image-preview"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üìç Exact Location Where Found *</label>
                            <input type="text" class="form-input" id="found-location" placeholder="123 Main St, Naples, FL or nearest intersection" required />
                            <small style="color: var(--text-secondary);">Be as specific as possible (street address, parking lot name, etc.)</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üìù Additional Details</label>
                            <textarea class="form-textarea" id="additional-details" placeholder="Any additional information about the vehicle's condition, damage, occupants, etc."></textarea>
                        </div>

                        <div class="input-group" style="margin-top: 20px;">
                            <button class="btn btn-secondary" onclick="goToStep(4)">‚Üê Back</button>
                            <button class="btn btn-primary" onclick="goToStep(6)">
                                Continue to Reward Info ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 6: Reward Payment Information -->
                    <div class="step" id="step6">
                        <div class="step-header">
                            <div class="step-number">6</div>
                            <div>
                                <h3 style="margin: 0;">Reward Payment Information</h3>
                                <p style="margin: 5px 0 0; opacity: 0.9; font-size: 14px;">How you'll receive your reward</p>
                            </div>
                        </div>

                        <div style="background: #dcfce7; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                            <h3 style="color: var(--success); margin-bottom: 15px;">üí∞ Your Reward</h3>
                            <p style="font-size: 18px; margin-bottom: 10px;">
                                <strong>Vehicle Protection Plan:</strong> <span id="reward-plan">Gold Plan</span>
                            </p>
                            <p style="font-size: 24px; font-weight: bold; color: var(--success);">
                                Reward Amount: $<span id="reward-amount">300</span>
                            </p>
                            <p style="margin-top: 15px; font-size: 14px;">
                                ‚è∞ <strong>Processing Time:</strong> 2-5 business days after verification<br>
                                ‚úÖ <strong>Verification:</strong> We'll confirm with the police department and vehicle owner
                            </p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üë§ Contact Name for Reward *</label>
                            <input type="text" class="form-input" id="reward-contact-name" placeholder="Your full name" required />
                        </div>

                        <div class="form-group">
                            <label class="form-label">üìß Email Address *</label>
                            <input type="email" class="form-input" id="reward-email" placeholder="your.email@example.com" required />
                            <small style="color: var(--text-secondary);">We'll send updates about your reward status</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üì± Phone Number *</label>
                            <input type="tel" class="form-input" id="reward-phone" placeholder="(555) 123-4567" required />
                        </div>

                        <div class="form-group">
                            <label class="form-label">üí∞ Zelle Contact (Email or Phone) *</label>
                            <input type="text" class="form-input" id="zelle-contact" placeholder="zelle@email.com or (555) 123-4567" required />
                            <small style="color: var(--text-secondary);">We'll send your reward via Zelle to this email or phone number</small>
                        </div>

                        <div class="input-group" style="margin-top: 20px;">
                            <button class="btn btn-secondary" onclick="goToStep(5)">‚Üê Back</button>
                            <button class="btn btn-primary" onclick="submitFoundVehicleReport()" style="font-size: 16px;">
                                üì§ Submit Report & Claim Reward
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insurance Portal Section -->
            <div class="content-section" id="insurance-section">
                <div class="header">
                    <h1 class="header-title">Insurance Portal</h1>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üè¢</span>
                        Insurance Company Access
                    </h2>
                    
                    <div class="insurance-login">
                        <p style="color: var(--text-secondary); margin-bottom: 30px; text-align: center;">
                            Secure portal for insurance company partners to verify theft reports and access recovery data.
                        </p>

                        <div class="form-group">
                            <label class="form-label">üè¢ Company Email</label>
                            <input type="email" class="form-input" placeholder="claims@insurance.com" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">üîí Password</label>
                            <input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                        </div>

                        <button class="btn btn-primary" style="width: 100%; margin-bottom: 20px;">
                            üîê Login to Portal
                        </button>

                        <hr style="margin: 30px 0; border: none; border-top: 1px solid #e5e7eb;" />

                        <h3 style="text-align: center; margin-bottom: 20px;">New Partner Registration</h3>

                        <div class="form-group">
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-input" placeholder="ABC Insurance Co." />
                        </div>

                        <div class="form-group">
                            <label class="form-label">License Number</label>
                            <input type="text" class="form-input" placeholder="License #" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Contact Person</label>
                            <input type="text" class="form-input" placeholder="Full Name" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Business Email</label>
                            <input type="email" class="form-input" placeholder="contact@company.com" />
                        </div>

                        <button class="btn btn-primary" style="width: 100%;">
                            üìã Register Company
                        </button>
                    </div>
                </div>
            </div>

            <!-- Carfax Integration Section -->
            <div class="content-section" id="carfax-section">
                <div class="header">
                    <h1 class="header-title">Carfax Integration</h1>
                </div>

                <div class="card">
                    <div class="carfax-header">
                        <h1 style="font-size: 36px; margin-bottom: 10px;">üöó CARFAX¬Æ</h1>
                        <p>Vehicle History & Theft Records</p>
                    </div>

                    <h2 class="card-title">
                        <span class="card-icon">üìã</span>
                        Get Vehicle History Report
                    </h2>

                    <div class="form-group">
                        <label class="form-label">Enter VIN Number</label>
                        <input type="text" class="form-input" id="carfax-vin" placeholder="17-digit VIN" maxlength="17" />
                    </div>

                    <button class="btn btn-primary" onclick="lookupCarfax()" style="width: 100%; margin-bottom: 30px;">
                        üîç Get Full Vehicle History
                    </button>

                    <div style="background: #f9fafb; padding: 20px; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px;">What You'll Get:</h3>
                        <div style="display: grid; gap: 10px;">
                            <div>‚úì Complete ownership history</div>
                            <div>‚úì Accident and damage reports</div>
                            <div>‚úì Service and maintenance records</div>
                            <div>‚úì Title and registration details</div>
                            <div>‚úì Theft check and recovery records</div>
                            <div>‚úì Mileage verification</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div class="content-section" id="analytics-section">
                <div class="header">
                    <h1 class="header-title">Analytics</h1>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üìä</span>
                        Platform Statistics
                    </h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-icon">üö®</div>
                            <div class="stat-value">1,247</div>
                            <div class="stat-label">Total Theft Reports</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">‚úÖ</div>
                            <div class="stat-value">1,089</div>
                            <div class="stat-label">Successful Recoveries</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üîî</div>
                            <div class="stat-value">158</div>
                            <div class="stat-label">Active Alerts</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-value">47,892</div>
                            <div class="stat-label">Community Members</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-value">4.2 hrs</div>
                            <div class="stat-label">Avg Recovery Time</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-value">87.3%</div>
                            <div class="stat-label">Success Rate</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="content-section" id="settings-section">
                <div class="header">
                    <h1 class="header-title">Settings</h1>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">‚öôÔ∏è</span>
                        Account Settings
                    </h2>

                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="settings-email" value="user@example.com" readonly />
                    </div>

                    <div class="form-group">
                        <label class="form-label">Member Since</label>
                        <input type="text" class="form-input" id="member-since" readonly />
                    </div>

                    <h3 style="margin: 30px 0 20px;">Notification Preferences</h3>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="email-notifications" checked style="margin-right: 10px;" />
                            <span>üìß Email Notifications</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="sms-notifications" checked style="margin-right: 10px;" />
                            <span>üí¨ SMS Alerts</span>
                        </label>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="push-notifications" checked style="margin-right: 10px;" />
                            <span>üîî Push Notifications</span>
                        </label>
                    </div>

                    <h3 style="margin: 30px 0 20px;">Alert Radius</h3>

                    <div class="form-group">
                        <label class="form-label">Notification Distance: <span id="radius-value">5</span> miles</label>
                        <input type="range" id="alert-radius" min="1" max="25" value="5" style="width: 100%;" />
                    </div>

                    <button class="btn btn-primary" style="margin-top: 20px;">
                        üíæ Save Settings
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Vehicle Modal -->
    <div id="add-vehicle-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Vehicle</h2>
                <button class="close-modal" onclick="closeAddVehicleModal()">√ó</button>
            </div>

            <form id="add-vehicle-form">
                <div class="form-group">
                    <label class="form-label">üì∏ Vehicle Photo</label>
                    <div class="image-upload" id="vehicle-image-upload">
                        <div>üì∑ Click or drag photo here</div>
                    </div>
                    <input type="file" id="vehicle-photo" accept="image/*" style="display: none;" />
                    <div id="vehicle-image-preview" class="image-preview"></div>
                </div>

                <h3 style="margin: 25px 0 15px; color: var(--primary);">üîç VIN Auto-Lookup</h3>
                <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px;">
                    Enter your license plate to automatically fill vehicle details
                </p>

                <div class="input-group">
                    <div class="form-group">
                        <label class="form-label">License Plate *</label>
                        <input type="text" class="form-input" id="license-plate" placeholder="ABC1234" required />
                    </div>

                    <div class="form-group">
                        <label class="form-label">State *</label>
                        <select class="form-select" id="plate-state" required>
                            <option value="">Select State</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                            <option value="DC">Washington DC</option>
                        </select>
                    </div>
                </div>

                <button type="button" class="btn btn-primary" onclick="lookupVIN()" style="width: 100%; margin-bottom: 20px;">
                    üîç Auto-Lookup VIN
                </button>

                <div id="lookup-status" class="lookup-status"></div>

                <div class="form-group">
                    <label class="form-label">VIN Number (Optional)</label>
                    <input type="text" class="form-input" id="vin" placeholder="17-digit VIN" maxlength="17" />
                    <small style="color: var(--text-secondary);">VIN helps with insurance claims and theft recovery</small>
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label class="form-label">Year *</label>
                        <select class="form-select" id="year" required>
                            <option value="">Select Year</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Make *</label>
                        <select class="form-select" id="make" required>
                            <option value="">Select Make</option>
                        </select>
                    </div>
                </div>

                <div class="input-group">
                    <div class="form-group">
                        <label class="form-label">Model *</label>
                        <select class="form-select" id="model" required>
                            <option value="">Select Model</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Color</label>
                        <select class="form-select" id="color">
                            <option value="">Select Color</option>
                            <option value="Black">Black</option>
                            <option value="White">White</option>
                            <option value="Silver">Silver</option>
                            <option value="Gray">Gray</option>
                            <option value="Red">Red</option>
                            <option value="Blue">Blue</option>
                            <option value="Green">Green</option>
                            <option value="Yellow">Yellow</option>
                            <option value="Orange">Orange</option>
                            <option value="Brown">Brown</option>
                            <option value="Gold">Gold</option>
                            <option value="Beige">Beige</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üé® What Stands Out From Your Car? (Optional)</label>
                    <textarea class="form-textarea" id="distinguishing-features" placeholder="e.g., Large dent on driver door, Custom red rims, Bumper sticker that says 'I ‚ù§Ô∏è Naples', Cracked windshield, Tinted windows, etc."></textarea>
                    <small style="color: var(--text-secondary);">List any unique features, damage, stickers, or modifications that make your car easy to identify (helps with recovery)</small>
                </div>

                <div class="form-group">
                    <label class="form-label">Protection Plan *</label>
                    <select class="form-select" id="protection-plan" required>
                        <option value="">Select Plan</option>
                        <option value="Basic">Basic - $17.99/month ($200 reward)</option>
                        <option value="Gold">Gold - $24.99/month ($300 reward)</option>
                        <option value="Diamond">Diamond - $29.99/month ($500 reward)</option>
                        <option value="Platinum">Platinum - $35.00/month ($750 reward)</option>
                    </select>
                </div>

                <div class="input-group">
                    <button type="button" class="btn btn-secondary" onclick="closeAddVehicleModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">‚ûï Add Vehicle</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Initialize Stripe -->
    <script>
        const stripe = Stripe('pk_test_51Rnl8WF2AvYulrbMus9slPTf8DuDEpkpW9r5j58u4458C5CQIRYRmKL94j5TEeIyYDkdARjurJQEtsbJ9srCI4cW00GzBsKoqy');
    </script>

    <script>
        // Global Variables
        let map;
        let stolenVehicles = [];
        let currentStep = 1;
        let foundVehicleData = {};
        const API_URL = 'http://localhost:3000';
        const STRIPE_PRICE_IDS = {
    basic: 'price_1QeTcRRxPKUgpxLKFsjv4iZC',      // ‚Üê YOUR Basic price ID
    gold: 'price_1QeTcnRxPKUgpxLKRvvfzC3Q',       // ‚Üê YOUR Gold price ID
    diamond: 'price_1QeTd4RxPKUgpxLKJKZyaG0O',    // ‚Üê YOUR Diamond price ID
    platinum: 'price_1QeTdFRxPKUgpxLKU1oXUa9w'    // ‚Üê YOUR Platinum price ID
};

        // Mock stolen vehicles database
        const mockStolenVehicles = {
            'ABC123': { year: '2021', make: 'Honda', model: 'Civic', plan: 'Gold', reward: 300 },
            'XYZ789': { year: '2020', make: 'Tesla', model: 'Model S', plan: 'Diamond', reward: 500 },
            'TEST99': { year: '2022', make: 'Chevrolet', model: 'Camaro', plan: 'Platinum', reward: 750 }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            handlePaymentRedirect();
            initializeYearDropdown();
            initializeMakeDropdown();
            setupImageUpload();
            setupFoundVehicleImageUpload();
            
            // Update radius value display
            document.getElementById('alert-radius').addEventListener('input', (e) => {
                document.getElementById('radius-value').textContent = e.target.value;
            });

            // Disable proceed buttons initially
            document.getElementById('proceed-step3').disabled = true;
            document.getElementById('proceed-step4').disabled = true;

            // Enable proceed buttons when checkboxes are checked
            document.getElementById('called-911').addEventListener('change', (e) => {
                document.getElementById('proceed-step3').disabled = !e.target.checked;
            });

            document.getElementById('police-arrived').addEventListener('change', (e) => {
                document.getElementById('proceed-step4').disabled = !e.target.checked;
            });

            // Update stats every 3 seconds
            setInterval(updateLiveStats, 3000);
        });

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            document.getElementById(sectionId + '-section').classList.add('active');
            event.target.closest('.nav-link').classList.add('active');
            
            if (sectionId === 'map-alerts' && !map) {
                initializeMap();
            }
            
            if (sectionId === 'map-alerts' && map) {
                setTimeout(() => map.invalidateSize(), 100);
            }

            // Reset found vehicle form if leaving the section
            if (sectionId !== 'found-vehicle') {
                resetFoundVehicleForm();
            }
        }

        // Found Vehicle Step Navigation
        function goToStep(stepNumber) {
            // Validation before proceeding
            if (stepNumber === 3) {
                const reporterName = document.getElementById('reporter-name').value.trim();
                const called911 = document.getElementById('called-911').checked;
                
                if (!reporterName) {
                    alert('Please enter your full name as given to 911');
                    return;
                }
                if (!called911) {
                    alert('You must confirm that you called 911 before proceeding');
                    return;
                }
            }

            if (stepNumber === 4) {
                const policeArrived = document.getElementById('police-arrived').checked;
                if (!policeArrived) {
                    alert('Please confirm that police have arrived');
                    return;
                }
            }

            if (stepNumber === 5) {
                const reportNumber = document.getElementById('report-number').value.trim();
                const officerName = document.getElementById('officer-name').value.trim();
                const policeDept = document.getElementById('police-department').value.trim();
                
                if (!reportNumber || !officerName || !policeDept) {
                    alert('Please fill in all required police report information');
                    return;
                }
            }

            if (stepNumber === 6) {
                const location = document.getElementById('found-location').value.trim();
                if (!location) {
                    alert('Please enter the location where the vehicle was found');
                    return;
                }
            }

            // Hide all steps
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            
            // Show requested step
            document.getElementById('step' + stepNumber).classList.add('active');
            currentStep = stepNumber;

            // Scroll to top of section
            document.getElementById('found-vehicle-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function resetFoundVehicleForm() {
            currentStep = 1;
            foundVehicleData = {};
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step1').classList.add('active');
            document.getElementById('check-plate').value = '';
            document.getElementById('check-state').value = '';
            document.getElementById('plate-check-result').innerHTML = '';
        }

        // Check License Plate Against Stolen Database
        function checkLicensePlate() {
            const plate = document.getElementById('check-plate').value.trim().toUpperCase();
            const state = document.getElementById('check-state').value;
            const resultDiv = document.getElementById('plate-check-result');

            if (!plate || !state) {
                alert('Please enter both license plate and state');
                return;
            }

            // Store for later steps
            foundVehicleData.plate = plate;
            foundVehicleData.state = state;

            // Check mock database
            if (mockStolenVehicles[plate]) {
                const vehicle = mockStolenVehicles[plate];
                foundVehicleData.vehicle = vehicle;
                
                resultDiv.innerHTML = `
                    <div class="check-result stolen">
                        <h2 style="color: var(--danger); margin-bottom: 15px;">üö® STOLEN VEHICLE CONFIRMED!</h2>
                        <div style="text-align: left; background: white; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <p style="margin-bottom: 10px;"><strong>License Plate:</strong> ${plate}</p>
                            <p style="margin-bottom: 10px;"><strong>Vehicle:</strong> ${vehicle.year} ${vehicle.make} ${vehicle.model}</p>
                            <p style="margin-bottom: 10px;"><strong>Protection Plan:</strong> ${vehicle.plan}</p>
                            <p style="font-size: 20px; font-weight: bold; color: var(--success); margin-top: 15px;">
                                üí∞ Recovery Reward: $${vehicle.reward}
                            </p>
                        </div>
                        <div class="warning-box danger" style="text-align: left;">
                            <h3>‚ö†Ô∏è CRITICAL NEXT STEPS:</h3>
                            <ol style="margin: 15px 0 0 20px;">
                                <li style="margin-bottom: 10px;"><strong>DO NOT APPROACH THE VEHICLE</strong></li>
                                <li style="margin-bottom: 10px;"><strong>CALL 911 IMMEDIATELY</strong></li>
                                <li style="margin-bottom: 10px;"><strong>Maintain safe distance</strong></li>
                                <li><strong>Follow our step-by-step process</strong></li>
                            </ol>
                        </div>
                        <button class="btn btn-primary" onclick="proceedToCall911()" style="width: 100%; margin-top: 20px; font-size: 18px; padding: 15px;">
                            Continue to Step 2: Call 911 ‚Üí
                        </button>
                    </div>
                `;
                
                // Update display placeholders for next steps
                document.getElementById('display-plate').textContent = plate;
                document.getElementById('display-vehicle').textContent = `${vehicle.year} ${vehicle.make} ${vehicle.model}`;
                document.getElementById('reward-plan').textContent = vehicle.plan + ' Plan';
                document.getElementById('reward-amount').textContent = vehicle.reward;
            } else {
                resultDiv.innerHTML = `
                    <div class="check-result not-stolen">
                        <h2 style="color: var(--success); margin-bottom: 15px;">‚úÖ Not In Our Database</h2>
                        <p style="margin-bottom: 15px;">License plate <strong>${plate}</strong> is not currently reported as stolen in our system.</p>
                        <div style="background: white; padding: 20px; border-radius: 8px; text-align: left; margin: 20px 0;">
                            <h3 style="margin-bottom: 10px;">This could mean:</h3>
                            <ul style="margin-left: 20px;">
                                <li style="margin-bottom: 8px;">The vehicle is not stolen</li>
                                <li style="margin-bottom: 8px;">It's stolen but not registered with CarTrace Pro</li>
                                <li style="margin-bottom: 8px;">The owner hasn't reported it yet</li>
                            </ul>
                        </div>
                        <p style="font-size: 14px; color: var(--text-secondary); margin-top: 15px;">
                            Try test plates: ABC123, XYZ789, or TEST99 to see the stolen vehicle workflow
                        </p>
                    </div>
                `;
            }
        }

        function proceedToCall911() {
            goToStep(2);
        }

        // Submit Found Vehicle Report
        function submitFoundVehicleReport() {
            const reportData = {
                ...foundVehicleData,
                reportNumber: document.getElementById('report-number').value,
                officerName: document.getElementById('officer-name').value,
                badgeNumber: document.getElementById('badge-number').value,
                policeDepartment: document.getElementById('police-department').value,
                location: document.getElementById('found-location').value,
                additionalDetails: document.getElementById('additional-details').value,
                contactName: document.getElementById('reward-contact-name').value,
                email: document.getElementById('reward-email').value,
                phone: document.getElementById('reward-phone').value,
                zelleContact: document.getElementById('zelle-contact').value,
                reportId: 'FR' + Date.now().toString().slice(-8),
                timestamp: new Date().toISOString()
            };

            const vehicle = foundVehicleData.vehicle;

            alert(
                `‚úÖ REPORT SUBMITTED SUCCESSFULLY!\n\n` +
                `üöó License Plate: ${foundVehicleData.plate}\n` +
                `üìç Location: ${reportData.location}\n` +
                `üìã Police Report: ${reportData.reportNumber}\n` +
                `üëÆ Officer: ${reportData.officerName}\n` +
                `üè¢ Department: ${reportData.policeDepartment}\n\n` +
                `üí∞ REWARD INFORMATION:\n` +
                `   Protection Plan: ${vehicle.plan}\n` +
                `   Reward Amount: $${vehicle.reward}\n` +
                `   Payment Method: Zelle to ${reportData.zelleContact}\n\n` +
                `‚è≥ VERIFICATION PROCESS:\n\n` +
                `1Ô∏è‚É£ Our team will verify with ${reportData.policeDepartment}\n` +
                `2Ô∏è‚É£ We'll confirm report #${reportData.reportNumber} with ${reportData.officerName}\n` +
                `3Ô∏è‚É£ Match with vehicle owner's theft report\n` +
                `4Ô∏è‚É£ Process $${vehicle.reward} reward payment via Zelle\n\n` +
                `‚è∞ Timeline: 2-5 business days\n` +
                `üìß Email updates sent to: ${reportData.email}\n\n` +
                `üôè Thank you for helping our community!\n` +
                `Your safety-first approach is exemplary.\n\n` +
                `Report ID: ${reportData.reportId}\n` +
                `Save this number for reference.`
            );

            // Reset form
            resetFoundVehicleForm();
        }

        // Modal Functions
        function openAddVehicleModal() {
            document.getElementById('add-vehicle-modal').classList.add('active');
        }

        function closeAddVehicleModal() {
            document.getElementById('add-vehicle-modal').classList.remove('active');
            document.getElementById('add-vehicle-form').reset();
            document.getElementById('vehicle-image-preview').innerHTML = '';
            clearLookupStatus();
        }

        // Initialize Year Dropdown (1990-2026)
        function initializeYearDropdown() {
            const yearSelect = document.getElementById('year');
            const currentYear = new Date().getFullYear();
            for (let year = currentYear + 1; year >= 1990; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }

        // Initialize Make Dropdown with expanded models
        function initializeMakeDropdown() {
            const makes = ['Acura', 'Audi', 'BMW', 'Buick', 'Cadillac', 'Chevrolet', 'Chrysler', 'Dodge', 'Ford', 'GMC', 'Honda', 'Hyundai', 'Infiniti', 'Jeep', 'Kia', 'Lexus', 'Lincoln', 'Mazda', 'Mercedes-Benz', 'Nissan', 'Ram', 'Subaru', 'Tesla', 'Toyota', 'Volkswagen', 'Volvo'];
            
            const makeSelect = document.getElementById('make');
            makes.forEach(make => {
                const option = document.createElement('option');
                option.value = make;
                option.textContent = make;
                makeSelect.appendChild(option);
            });

            // Add change event listener
            makeSelect.addEventListener('change', function(e) {
                const selectedMake = e.target.value;
                console.log('Make selected:', selectedMake); // Debug log
                if (selectedMake) {
                    updateModelDropdown(selectedMake);
                }
            });
        }

        // Update Model Dropdown based on Make - EXPANDED MODEL LIST
        function updateModelDropdown(make) {
            console.log('Updating models for:', make); // Debug log
            
            const models = {
                'Acura': ['ILX', 'TLX', 'RLX', 'MDX', 'RDX', 'NSX'],
                'Audi': ['A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'Q3', 'Q5', 'Q7', 'Q8', 'e-tron'],
                'BMW': ['2 Series', '3 Series', '4 Series', '5 Series', '7 Series', 'X1', 'X3', 'X5', 'X7', 'M3', 'M5'],
                'Buick': ['Encore', 'Envision', 'Enclave'],
                'Cadillac': ['CT4', 'CT5', 'XT4', 'XT5', 'XT6', 'Escalade'],
                'Chevrolet': ['Spark', 'Malibu', 'Impala', 'Camaro', 'Corvette', 'Trax', 'Equinox', 'Traverse', 'Tahoe', 'Suburban', 'Silverado', 'Colorado'],
                'Chrysler': ['300', 'Pacifica', 'Voyager'],
                'Dodge': ['Charger', 'Challenger', 'Durango', 'Journey'],
                'Ford': ['Fiesta', 'Focus', 'Fusion', 'Mustang', 'EcoSport', 'Escape', 'Edge', 'Explorer', 'Expedition', 'F-150', 'F-250', 'F-350', 'Ranger', 'Bronco'],
                'GMC': ['Terrain', 'Acadia', 'Yukon', 'Sierra 1500', 'Sierra 2500', 'Canyon'],
                'Honda': ['Fit', 'Civic', 'Accord', 'Insight', 'HR-V', 'CR-V', 'Passport', 'Pilot', 'Ridgeline'],
                'Hyundai': ['Accent', 'Elantra', 'Sonata', 'Veloster', 'Venue', 'Kona', 'Tucson', 'Santa Fe', 'Palisade'],
                'Infiniti': ['Q50', 'Q60', 'QX50', 'QX60', 'QX80'],
                'Jeep': ['Renegade', 'Compass', 'Cherokee', 'Grand Cherokee', 'Wrangler', 'Gladiator'],
                'Kia': ['Rio', 'Forte', 'K5', 'Stinger', 'Soul', 'Seltos', 'Sportage', 'Sorento', 'Telluride'],
                'Lexus': ['IS', 'ES', 'GS', 'LS', 'UX', 'NX', 'RX', 'GX', 'LX'],
                'Lincoln': ['Corsair', 'Nautilus', 'Aviator', 'Navigator'],
                'Mazda': ['Mazda3', 'Mazda6', 'CX-3', 'CX-30', 'CX-5', 'CX-9', 'MX-5 Miata'],
                'Mercedes-Benz': ['A-Class', 'C-Class', 'E-Class', 'S-Class', 'GLA', 'GLB', 'GLC', 'GLE', 'GLS'],
                'Nissan': ['Versa', 'Sentra', 'Altima', 'Maxima', '370Z', 'Kicks', 'Rogue', 'Murano', 'Pathfinder', 'Armada', 'Frontier', 'Titan'],
                'Ram': ['1500', '2500', '3500', 'ProMaster'],
                'Subaru': ['Impreza', 'Legacy', 'WRX', 'Crosstrek', 'Forester', 'Outback', 'Ascent'],
                'Tesla': ['Model 3', 'Model S', 'Model X', 'Model Y', 'Cybertruck'],
                'Toyota': ['Yaris', 'Corolla', 'Camry', 'Avalon', 'Prius', '86', 'Supra', 'C-HR', 'RAV4', 'Venza', 'Highlander', '4Runner', 'Sequoia', 'Land Cruiser', 'Tacoma', 'Tundra'],
                'Volkswagen': ['Jetta', 'Passat', 'Arteon', 'Golf', 'GTI', 'Taos', 'Tiguan', 'Atlas'],
                'Volvo': ['S60', 'S90', 'V60', 'V90', 'XC40', 'XC60', 'XC90']
            };

            const modelSelect = document.getElementById('model');
            // Clear existing options
            modelSelect.innerHTML = '<option value="">Select Model</option>';

            if (models[make]) {
                console.log('Found models:', models[make]); // Debug log
                models[make].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
            } else {
                console.log('No models found, adding Other option'); // Debug log
                const option = document.createElement('option');
                option.value = 'Other';
                option.textContent = 'Other/Custom';
                modelSelect.appendChild(option);
            }
        }

        // VIN Lookup Function
        async function lookupVIN() {
            const licensePlate = document.getElementById('license-plate').value.trim();
            const state = document.getElementById('plate-state').value;
            const statusDiv = document.getElementById('lookup-status');

            if (!licensePlate || !state) {
                showLookupStatus('error', '‚ùå Please enter both license plate and state');
                return;
            }

            showLookupStatus('loading', 'üîÑ Looking up vehicle information...');

            try {
                const mockData = {
                    'ABC123': {
                        vin: '1HGBH41JXMN109186',
                        year: '2021',
                        make: 'Honda',
                        model: 'Civic',
                        color: 'Silver'
                    },
                    'XYZ789': {
                        vin: '5YJSA1E14HF123456',
                        year: '2020',
                        make: 'Tesla',
                        model: 'Model S',
                        color: 'White'
                    },
                    'TEST99': {
                        vin: '1G1ZD5ST8LF123789',
                        year: '2022',
                        make: 'Chevrolet',
                        model: 'Camaro',
                        color: 'Red'
                    }
                };

                await new Promise(resolve => setTimeout(resolve, 1500));

                const vehicleData = mockData[licensePlate.toUpperCase()];

                if (vehicleData) {
                    document.getElementById('vin').value = vehicleData.vin;
                    document.getElementById('year').value = vehicleData.year;
                    document.getElementById('make').value = vehicleData.make;
                    
                    // Trigger model update
                    updateModelDropdown(vehicleData.make);
                    
                    // Set model after a brief delay to ensure dropdown is populated
                    setTimeout(() => {
                        document.getElementById('model').value = vehicleData.model;
                    }, 100);
                    
                    document.getElementById('color').value = vehicleData.color;

                    showLookupStatus('success', '‚úÖ Vehicle found! Details auto-filled.');
                } else {
                    showLookupStatus('error', '‚ùå Vehicle not found. Please enter details manually. Try: ABC123, XYZ789, or TEST99 for demo.');
                }
            } catch (error) {
                showLookupStatus('error', '‚ùå Lookup failed. Please enter details manually.');
            }
        }

        function showLookupStatus(type, message) {
            const statusDiv = document.getElementById('lookup-status');
            statusDiv.className = 'lookup-status ' + type;
            statusDiv.textContent = message;
        }

        function clearLookupStatus() {
            const statusDiv = document.getElementById('lookup-status');
            statusDiv.className = 'lookup-status';
            statusDiv.textContent = '';
        }

        // Image Upload Setup
        function setupImageUpload() {
            const uploadArea = document.getElementById('vehicle-image-upload');
            const fileInput = document.getElementById('vehicle-photo');

            uploadArea.addEventListener('click', () => fileInput.click());

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    displayVehicleImage(e.target.files[0]);
                }
            });

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                if (e.dataTransfer.files.length > 0) {
                    displayVehicleImage(e.dataTransfer.files[0]);
                }
            });
        }

        function displayVehicleImage(file) {
            const preview = document.getElementById('vehicle-image-preview');
            preview.innerHTML = '';

            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.className = 'preview-image';
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        }

        // Found Vehicle Image Upload
        function setupFoundVehicleImageUpload() {
            const uploadArea = document.getElementById('found-image-upload');
            const fileInput = document.getElementById('found-photos');

            uploadArea.addEventListener('click', () => fileInput.click());

            fileInput.addEventListener('change', (e) => {
                displayFoundImages(Array.from(e.target.files));
            });

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                displayFoundImages(Array.from(e.dataTransfer.files));
            });
        }

        function displayFoundImages(files) {
            const preview = document.getElementById('found-image-preview');
            preview.innerHTML = '';

            files.slice(0, 4).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'preview-image';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }

        // Add Vehicle Form Submit
        document.getElementById('add-vehicle-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    console.log('üìù Form submitted - processing vehicle data...');

    const vehicleData = {
        id: 'V' + Date.now(),
        licensePlate: document.getElementById('license-plate').value,
        vin: document.getElementById('vin').value || 'Not provided',
        year: document.getElementById('year').value,
        make: document.getElementById('make').value,
        model: document.getElementById('model').value,
        color: document.getElementById('color').value,
        distinguishingFeatures: document.getElementById('distinguishing-features').value,
        protectionPlan: document.getElementById('protection-plan').value.split(' - ')[0],
        gpsEnabled: false,
        isStolen: false,
        addedDate: new Date().toISOString()
    };

    const protectionPlanFull = document.getElementById('protection-plan').value;
    
    if (!protectionPlanFull) {
        alert('‚ö†Ô∏è Please select a protection plan');
        return;
    }

    // Validate required fields
    if (!vehicleData.licensePlate || !vehicleData.year || !vehicleData.make || !vehicleData.model) {
        alert('‚ö†Ô∏è Please fill in all required fields');
        return;
    }

    console.log('‚úÖ Vehicle data collected:', vehicleData);

    const photoFile = document.getElementById('vehicle-photo').files[0];
    if (photoFile) {
        console.log('üì∏ Processing vehicle photo...');
        const reader = new FileReader();
        reader.onload = async (e) => {
            vehicleData.photoURL = e.target.result;
            // ‚úÖ REDIRECT TO PAYMENT FIRST!
            await startCheckoutWithVehicle(protectionPlanFull, vehicleData);
        };
        reader.readAsDataURL(photoFile);
    } else {
        vehicleData.photoURL = 'https://via.placeholder.com/150x150?text=No+Photo';
        // ‚úÖ REDIRECT TO PAYMENT FIRST!
        await startCheckoutWithVehicle(protectionPlanFull, vehicleData);
    }
});

            const photoFile = document.getElementById('vehicle-photo').files[0];
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    vehicleData.photoURL = e.target.result;
                    saveVehicle(vehicleData);
                };
                reader.readAsDataURL(photoFile);
            } else {
                vehicleData.photoURL = 'https://via.placeholder.com/150x150?text=No+Photo';
                saveVehicle(vehicleData);
            }
        });

        function saveVehicle(vehicleData) {
            if (window.firebaseDatabase && window.currentUser) {
                const vehicleRef = window.firebaseRef(window.firebaseDatabase, `vehicles/${window.currentUser.uid}/${vehicleData.id}`);
                window.firebaseSet(vehicleRef, vehicleData)
                    .then(() => {
                        alert('‚úÖ Vehicle added successfully!');
                        closeAddVehicleModal();
                    })
                    .catch(error => {
                        console.error('Error saving vehicle:', error);
                        alert('‚ùå Failed to save vehicle. Please try again.');
                    });
            } else {
                let vehicles = JSON.parse(localStorage.getItem('cartraceVehicles') || '[]');
                vehicles.push(vehicleData);
                localStorage.setItem('cartraceVehicles', JSON.stringify(vehicles));
                alert('‚úÖ Vehicle added successfully!');
                closeAddVehicleModal();
                updateVehicleDisplay();
            }
        }

        function updateVehicleDisplay() {
            const vehiclesList = document.getElementById('vehicles-list');
            const vehicles = window.userVehicles || JSON.parse(localStorage.getItem('cartraceVehicles') || '[]');

            if (vehicles.length === 0) {
                vehiclesList.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <div style="font-size: 48px; margin-bottom: 20px;">üöó</div>
                        <h3 style="margin-bottom: 10px;">No Vehicles Added Yet</h3>
                        <p>Add your first vehicle to start protecting it with CarTrace Pro</p>
                        <button class="btn btn-primary" onclick="openAddVehicleModal()" style="margin-top: 20px;">Add Your First Vehicle</button>
                    </div>
                `;
                return;
            }

            vehiclesList.innerHTML = vehicles.map(vehicle => `
                <div class="vehicle-card ${vehicle.isStolen ? 'stolen' : ''}">
                    ${vehicle.isStolen ? '<div style="position: absolute; top: 20px; right: 20px; background: var(--danger); color: white; padding: 5px 15px; border-radius: 20px; font-weight: 600;">üö® STOLEN</div>' : ''}
                    <img src="${vehicle.photoURL || 'https://via.placeholder.com/150x150?text=No+Photo'}" alt="${vehicle.year} ${vehicle.make} ${vehicle.model}" class="vehicle-image" />
                    <div class="vehicle-content">
                        <div class="vehicle-header">
                            <div class="vehicle-info">
                                <h3>${vehicle.year} ${vehicle.make} ${vehicle.model}</h3>
                                <p style="color: var(--text-secondary);">${vehicle.color || 'Color not specified'}</p>
                            </div>
                        </div>
                        <div class="vehicle-details">
                            <div class="detail-item">
                                <span class="detail-label">License Plate</span>
                                <span>${vehicle.licensePlate}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">VIN</span>
                                <span>${vehicle.vin}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Protection Plan</span>
                                <span>${vehicle.protectionPlan}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">GPS Status</span>
                                <span>${vehicle.gpsEnabled ? '‚úÖ Active' : '‚≠ï Inactive'}</span>
                            </div>
                        </div>
                        ${vehicle.distinguishingFeatures ? `
                            <div style="margin-top: 15px; padding: 12px; background: #fef3c7; border-left: 3px solid var(--warning); border-radius: 6px;">
                                <strong style="color: var(--text-primary);">üé® Distinguishing Features:</strong>
                                <p style="margin-top: 5px; color: var(--text-primary);">${vehicle.distinguishingFeatures}</p>
                            </div>
                        ` : ''}
                        <div class="vehicle-actions" style="margin-top: 15px;">
                            <button class="btn btn-small btn-edit">‚úèÔ∏è Edit</button>
                            <button class="btn btn-small btn-delete" onclick="deleteVehicle('${vehicle.id}')">üóëÔ∏è Delete</button>
                            <button class="btn btn-small btn-report">üö® Report Stolen</button>
                            <button class="btn btn-small btn-gps" onclick="toggleGPS('${vehicle.id}')">
                                ${vehicle.gpsEnabled ? '‚≠ï Disable GPS' : 'üìç Enable GPS'}
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateVehicleCount() {
            const vehicles = window.userVehicles || JSON.parse(localStorage.getItem('cartraceVehicles') || '[]');
            document.getElementById('vehicle-count').textContent = vehicles.length;
        }

        function deleteVehicle(vehicleId) {
            if (!confirm('Are you sure you want to delete this vehicle?')) return;

            if (window.firebaseDatabase && window.currentUser) {
                const vehicleRef = window.firebaseRef(window.firebaseDatabase, `vehicles/${window.currentUser.uid}/${vehicleId}`);
                window.firebaseRemove(vehicleRef)
                    .then(() => {
                        alert('‚úÖ Vehicle deleted successfully');
                    })
                    .catch(error => {
                        console.error('Error deleting vehicle:', error);
                        alert('‚ùå Failed to delete vehicle');
                    });
            } else {
                let vehicles = JSON.parse(localStorage.getItem('cartraceVehicles') || '[]');
                vehicles = vehicles.filter(v => v.id !== vehicleId);
                localStorage.setItem('cartraceVehicles', JSON.stringify(vehicles));
                updateVehicleDisplay();
                updateVehicleCount();
            }
        }

        function toggleGPS(vehicleId) {
            alert('üöß GPS Tracking Feature Coming Soon!\n\nThis feature will allow you to:\n\n‚úì Track your vehicle in real-time\n‚úì Set up geofencing alerts\n‚úì View location history\n‚úì Get instant theft notifications\n\nStay tuned for updates!');
        }

        // Initialize Map
        function initializeMap() {
            if (map) return;

            map = L.map('map').setView([26.1420, -81.7948], 11);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            const demoLocations = [
                { lat: 26.1420, lng: -81.7948, plate: 'ABC123', make: 'Honda Civic' },
                { lat: 26.2159, lng: -81.7795, plate: 'XYZ789', make: 'Tesla Model S' }
            ];

            demoLocations.forEach(loc => {
                L.marker([loc.lat, loc.lng], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: '<div style="background: #ef4444; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;">üö®</div>'
                    })
                })
                .addTo(map)
                .bindPopup(`
                    <strong>üö® Stolen Vehicle Alert</strong><br>
                    ${loc.make}<br>
                    License: ${loc.plate}<br>
                    <button onclick="alert('Report sighting feature!')" style="margin-top: 10px; padding: 5px 10px; background: #4f46e5; color: white; border: none; border-radius: 5px; cursor: pointer;">Report Sighting</button>
                `);
            });
        }

        // Stripe Checkout
        async function startCheckout(plan) {
            const priceIds = {
                basic: 'price_1QeTcRRxPKUgpxLKFsjv4iZC',
                gold: 'price_1QeTcnRxPKUgpxLKRvvfzC3Q',
                diamond: 'price_1QeTd4RxPKUgpxLKJKZyaG0O',
                platinum: 'price_1QeTdFRxPKUgpxLKU1oXUa9w'
            };

            try {
                const response = await fetch(`${API_URL}/create-checkout-session`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        priceId: priceIds[plan],
                        userId: window.currentUser ? window.currentUser.uid : null,
                        userEmail: window.currentUser ? window.currentUser.email : null
                    })
                });

                const session = await response.json();
                
                const result = await stripe.redirectToCheckout({
                    sessionId: session.id
                });

                if (result.error) {
                    alert(result.error.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Unable to start checkout. Please make sure your backend server is running at ' + API_URL);
            }
        }

        // Carfax Lookup
        function lookupCarfax() {
            const vin = document.getElementById('carfax-vin').value.trim();
            if (!vin) {
                alert('Please enter a VIN number');
                return;
            }
            if (vin.length !== 17) {
                alert('VIN must be exactly 17 characters');
                return;
            }
            alert('üöß Carfax integration coming soon! You\'ll be able to get full vehicle history reports including theft records.');
        }

        // Sign Out
        function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                if (window.firebaseSignOut && window.firebaseAuth) {
                    window.firebaseSignOut(window.firebaseAuth).then(() => {
                        localStorage.clear();
                        sessionStorage.clear();
                        window.location.href = 'cartrace_homepage.html';
                    }).catch((error) => {
                        console.error('Logout error:', error);
                        window.location.href = 'cartrace_homepage.html';
                    });
                } else {
                    localStorage.clear();
                    window.location.href = 'cartrace_homepage.html';
                }
            }
        }

        // Live Stats Updates
        let networkUptime = 99.95;
        let responseTime = 0.8;
        let securityScore = 98;
        let activeUsers = 47892;

        function updateLiveStats() {
            const random = Math.random();
            
            if (random < 0.4) {
                networkUptime = Math.max(99.90, Math.min(99.99, networkUptime + (Math.random() - 0.5) * 0.02));
                responseTime = Math.max(0.5, Math.min(1.2, responseTime + (Math.random() - 0.5) * 0.1));
                securityScore = Math.max(90, Math.min(100, securityScore + Math.floor((Math.random() - 0.5) * 3)));
                activeUsers = 47892 + Math.floor(Math.random() * 100);
            }
            
            if (document.getElementById('network-uptime')) {
                document.getElementById('network-uptime').textContent = networkUptime.toFixed(2) + '%';
            }
            if (document.getElementById('response-time')) {
                document.getElementById('response-time').textContent = responseTime.toFixed(1);
            }
            if (document.getElementById('security-score')) {
                document.getElementById('security-score').textContent = securityScore;
            }
            if (document.getElementById('active-users')) {
                document.getElementById('active-users').textContent = activeUsers.toLocaleString();
            }
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            if (document.getElementById('last-update')) {
                document.getElementById('last-update').textContent = timeStr;
            }
        }
    </script>

    <!-- Firebase Module Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getDatabase, ref, set, get, push, remove, update, onValue, off } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB8iFriCB3kt4lWeXQUNj5LTsAXFZoXX0Y",
            authDomain: "cartrace-pro.firebaseapp.com",
            databaseURL: "https://cartrace-pro-default-rtdb.firebaseio.com/",
            projectId: "cartrace-pro",
            storageBucket: "cartrace-pro.firebasestorage.app",
            messagingSenderId: "341907523496",
            appId: "1:341907523496:web:f10a87930d939cf3b8ff9d",
            measurementId: "G-X01QW112CD"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const storage = getStorage(app);

        window.firebaseAuth = auth;
        window.firebaseDatabase = database;
        window.firebaseStorage = storage;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebasePush = push;
        window.firebaseRemove = remove;
        window.firebaseUpdate = update;
        window.firebaseOnValue = onValue;
        window.firebaseOff = off;
        window.firebaseSignOut = signOut;
        window.firebaseStorageRef = storageRef;
        window.firebaseUploadBytes = uploadBytes;
        window.firebaseGetDownloadURL = getDownloadURL;
        window.firebaseDeleteObject = deleteObject;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                window.currentUser = user;
                
                document.getElementById('user-email').textContent = user.email || 'User';
                if (document.getElementById('settings-email')) {
                    document.getElementById('settings-email').value = user.email || 'user@example.com';
                }
                if (document.getElementById('member-since')) {
                    document.getElementById('member-since').value = new Date(user.metadata.creationTime).toLocaleDateString();
                }
                
                document.getElementById('sync-status').textContent = '‚úÖ Synced';
                document.getElementById('sync-status').style.color = 'var(--success)';
                
                const vehiclesRef = ref(database, `vehicles/${user.uid}`);
                onValue(vehiclesRef, (snapshot) => {
                    const data = snapshot.val();
                    
                    if (data) {
                        window.userVehicles = Object.keys(data).map(key => ({
                            ...data[key],
                            id: data[key].id || key
                        }));
                        localStorage.setItem('cartraceVehicles', JSON.stringify(window.userVehicles));
                    } else {
                        window.userVehicles = [];
                        localStorage.setItem('cartraceVehicles', JSON.stringify([]));
                    }
                    
                    updateVehicleDisplay();
                    updateVehicleCount();
                });

                const alertsRef = ref(database, 'stolenVehicles');
                onValue(alertsRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const alerts = Object.keys(data).map(key => ({
                            ...data[key],
                            id: key
                        }));
                        
                        document.getElementById('alert-badge').textContent = alerts.length;
                        if (document.getElementById('active-alerts-count')) {
                            document.getElementById('active-alerts-count').textContent = alerts.length;
                        }
                        
                        stolenVehicles = alerts;
                    }
                });
            } else {
                console.log('No user logged in - using demo mode');
                document.getElementById('user-email').textContent = 'Demo User';
                document.getElementById('sync-status').textContent = 'üìç Demo Mode';
                
                window.userVehicles = JSON.parse(localStorage.getItem('cartraceVehicles') || '[]');
                updateVehicleDisplay();
                updateVehicleCount();
            }
        });

        function handlePaymentRedirect() {
    const urlParams = new URLSearchParams(window.location.search);
    
    if (urlParams.get('success') === 'true') {
        console.log('‚úÖ Payment successful! Processing vehicle...');
        
        const pendingVehicleJson = sessionStorage.getItem('pendingVehicle');
        
        if (pendingVehicleJson) {
            try {
                const vehicleData = JSON.parse(pendingVehicleJson);
                console.log('Saving vehicle after successful payment:', vehicleData);
                saveVehicleAfterPayment(vehicleData);
                sessionStorage.removeItem('pendingVehicle');
                
                setTimeout(() => {
                    alert('‚úÖ Payment Successful!\n\nüöó Your vehicle has been added.\nüí≥ Subscription activated.\n\nThank you for choosing CarTrace Pro!');
                }, 500);
            } catch (error) {
                console.error('Error parsing pending vehicle:', error);
                alert('‚ö†Ô∏è Payment successful but error adding vehicle. Contact support.');
            }
        }
        
        window.history.replaceState({}, document.title, window.location.pathname);
    }
    
    if (urlParams.get('canceled') === 'true') {
        console.log('‚ùå Payment canceled');
        sessionStorage.removeItem('pendingVehicle');
        alert('‚ùå Payment Canceled\n\nYour vehicle was not added.\nNo charges were made.');
        window.history.replaceState({}, document.title, window.location.pathname);
    }
}

// Function 2: Start Checkout With Vehicle
async function startCheckoutWithVehicle(protectionPlanFull, vehicleData) {
    try {
        const planName = protectionPlanFull.split(' - ')[0].toLowerCase();
        console.log('üí≥ Starting checkout for plan:', planName);

        const priceId = STRIPE_PRICE_IDS[planName];
        
        if (!priceId) {
            alert('‚ùå Invalid protection plan selected: ' + planName);
            return;
        }

        sessionStorage.setItem('pendingVehicle', JSON.stringify(vehicleData));
        console.log('‚úÖ Stored pending vehicle in session storage');

        const response = await fetch(`${API_URL}/create-checkout-session`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                priceId: priceId,
                userId: window.currentUser ? window.currentUser.uid : 'guest_' + Date.now(),
                userEmail: window.currentUser ? window.currentUser.email : null,
                vehicleData: vehicleData
            })
        });

        if (!response.ok) {
            throw new Error('Failed to create checkout session');
        }

        const session = await response.json();
        console.log('‚úÖ Checkout session created:', session.id);
        
        closeAddVehicleModal();
        
        const confirmProceed = confirm(
            'üí≥ Redirecting to Secure Payment\n\n' +
            '‚úÖ Your vehicle will be added after payment\n' +
            '‚úÖ Safe and secure with Stripe\n\n' +
            'Click OK to proceed'
        );

        if (!confirmProceed) {
            sessionStorage.removeItem('pendingVehicle');
            return;
        }

        console.log('üîÑ Redirecting to Stripe...');
        const result = await stripe.redirectToCheckout({ sessionId: session.id });

        if (result.error) {
            alert('‚ùå Payment error: ' + result.error.message);
            sessionStorage.removeItem('pendingVehicle');
        }

    } catch (error) {
        console.error('‚ùå Error starting checkout:', error);
        alert('‚ùå Unable to start checkout: ' + error.message);
        sessionStorage.removeItem('pendingVehicle');
    }
}

// Function 3: Save Vehicle After Payment
function saveVehicleAfterPayment(vehicleData) {
    console.log('üíæ Saving vehicle to database:', vehicleData);
    
    if (window.firebaseDatabase && window.currentUser) {
        const vehicleRef = window.firebaseRef(
            window.firebaseDatabase, 
            `vehicles/${window.currentUser.uid}/${vehicleData.id}`
        );
        
        window.firebaseSet(vehicleRef, vehicleData)
            .then(() => {
                console.log('‚úÖ Vehicle saved to Firebase');
            })
            .catch(error => {
                console.error('‚ùå Error saving to Firebase:', error);
                alert('‚ö†Ô∏è Error saving vehicle: ' + error.message);
            });
    } else {
        console.log('üíæ Saving to localStorage');
        let vehicles = JSON.parse(localStorage.getItem('cartraceVehicles') || '[]');
        vehicles.push(vehicleData);
        localStorage.setItem('cartraceVehicles', JSON.stringify(vehicles));
        updateVehicleDisplay();
        updateVehicleCount();
    }
}
    </script>
</body>
</html>

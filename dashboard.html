<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarTrace Pro - Enhanced Dashboard</title>
    
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Leaflet for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #2196F3;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
            --dark: #111827;
            --light: #f8fafc;
            --white: #FFFFFF;
            --surface: #f3f4f6;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --nav-selected: rgba(79, 70, 229, 0.1);
            --carfax-blue: #0057B8;
            --carfax-orange: #FF6B35;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .app-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><defs><radialGradient id="globeGrad" cx="50%" cy="40%" r="70%"><stop offset="0%" style="stop-color:%23a8c8ec"/><stop offset="100%" style="stop-color:%232563eb"/></radialGradient></defs><circle cx="200" cy="220" r="140" fill="url(%23globeGrad)"/><g stroke="white" stroke-width="3" fill="none"><circle cx="200" cy="220" r="140"/><ellipse cx="200" cy="220" rx="140" ry="70"/><ellipse cx="200" cy="220" rx="70" ry="140"/><line x1="60" y1="220" x2="340" y2="220"/><line x1="200" y1="80" x2="200" y2="360"/></g><path d="M200 80 L230 160 L200 200 Z" fill="%23dc2626"/><ellipse cx="210" cy="130" rx="18" ry="18" fill="white"/><text x="200" y="35" text-anchor="middle" fill="%23111827" font-family="Arial Black" font-size="40" font-weight="bold">Car Trace</text></svg>') center/contain no-repeat;
        }

        .app-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .app-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .sync-status {
            font-size: 12px;
            color: var(--success);
            margin-top: 10px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--primary);
            color: white;
            transform: translateX(4px);
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 18px;
        }

        /* Notification Badge */
        .notification-badge {
            background: var(--danger);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            animation: pulse 2s infinite;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Cards */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .card-icon {
            margin-right: 10px;
            font-size: 24px;
        }

        /* Vehicle List */
        .vehicle-list {
            display: grid;
            gap: 20px;
        }

        .vehicle-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-left: 4px solid var(--primary);
            position: relative;
        }

        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .vehicle-info h3 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .vehicle-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit {
            background: var(--info);
            color: white;
        }

        .btn-edit:hover {
            background: #2563eb;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .vehicle-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            background: none;
            border: none;
        }

        .close-modal:hover {
            color: var(--danger);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-select {
            background: white;
            cursor: pointer;
        }

        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-size: 16px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Map Container */
        #map {
            height: 600px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .alert-popup {
            padding: 10px;
        }

        .alert-popup h4 {
            color: var(--danger);
            margin-bottom: 8px;
        }

        .alert-popup p {
            margin: 4px 0;
            font-size: 13px;
        }

        .alert-popup .btn-small {
            margin-top: 10px;
            width: 100%;
        }

        /* Alert Card */
        .alert-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--danger);
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .alert-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .alert-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-active {
            background: #fee2e2;
            color: var(--danger);
        }

        .status-recovered {
            background: #d1fae5;
            color: var(--success);
        }

        /* Helper text for form fields */
        .form-helper {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .nav-link span {
                display: none;
            }
            
            .logo-section .app-title,
            .logo-section .app-subtitle {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="app-logo"></div>
                <div class="app-title">CarTrace Pro</div>
                <div class="app-subtitle">Vehicle Protection Network</div>
                <div class="sync-status" id="sync-status">⏳ Syncing...</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" onclick="showSection('dashboard')">
                        <span class="nav-icon">🏠</span>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('vehicles')">
                        <span class="nav-icon">🚗</span>
                        <span>My Vehicles</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('map-alerts')">
                        <span class="nav-icon">🗺️</span>
                        <span>Map & Alerts</span>
                        <span class="notification-badge" id="alert-badge">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('protection')">
                        <span class="nav-icon">🛡️</span>
                        <span>Protection Plans</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('found-vehicle')">
                        <span class="nav-icon">🔍</span>
                        <span>Found Vehicle</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('insurance')">
                        <span class="nav-icon">🏢</span>
                        <span>Insurance Portal</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('carfax')">
                        <span class="nav-icon">📋</span>
                        <span>Carfax Integration</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('analytics')">
                        <span class="nav-icon">📊</span>
                        <span>Analytics</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showSection('settings')">
                        <span class="nav-icon">⚙️</span>
                        <span>Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="signOut()">
                        <span class="nav-icon">🚪</span>
                        <span>Sign Out</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboard-section">
                <div class="header">
                    <div>
                        <h1 class="header-title">Welcome Back!</h1>
                        <p id="user-email">Loading...</p>
                    </div>
                    <div class="header-status">
                        <span class="status-dot"></span>
                        <span>Network Active</span>
                    </div>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">🚗</span>
                            Protected Vehicles
                        </div>
                        <div style="font-size: 36px; font-weight: bold; color: var(--primary); margin: 15px 0;">
                            <span id="vehicle-count">0</span>
                        </div>
                        <div style="color: var(--text-secondary); font-size: 14px;">
                            Active protection plans
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">🌐</span>
                            Network Status
                        </div>
                        <div style="font-size: 36px; font-weight: bold; color: var(--success); margin: 15px 0;">
                            <span id="active-users">47,892</span>
                        </div>
                        <div style="color: var(--text-secondary); font-size: 14px;">
                            Active community members
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">🎯</span>
                            Response Time
                        </div>
                        <div style="font-size: 36px; font-weight: bold; color: var(--info); margin: 15px 0;">
                            <span id="response-time">0.8</span>ms
                        </div>
                        <div style="color: var(--text-secondary); font-size: 14px;">
                            Average alert delivery
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">
                        <span class="card-icon">🔔</span>
                        Recent Alerts
                    </div>
                    <div id="recent-alerts">
                        <p style="color: var(--text-secondary); text-align: center; padding: 20px;">
                            No recent alerts in your area. Your vehicles are safe! ✅
                        </p>
                    </div>
                </div>
            </div>

            <!-- My Vehicles Section -->
            <div class="content-section" id="vehicles-section">
                <div class="header">
                    <h1 class="header-title">My Vehicles</h1>
                    <button class="btn btn-primary" onclick="showAddVehicleModal()" style="width: auto;">
                        + Add Vehicle
                    </button>
                </div>

                <div class="vehicle-list" id="vehicle-list">
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        No vehicles added yet. Click "Add Vehicle" to get started!
                    </p>
                </div>
            </div>

            <!-- Other sections remain the same as original file -->
            <!-- Map & Alerts Section -->
            <div class="content-section" id="map-alerts-section">
                <div class="header">
                    <h1 class="header-title">Live Map & Stolen Vehicle Alerts</h1>
                    <div class="header-status">
                        <span class="status-dot"></span>
                        <span>Real-Time Tracking Active</span>
                    </div>
                </div>

                <div class="card" style="margin-bottom: 20px;">
                    <div id="map"></div>
                </div>

                <div class="card">
                    <div class="card-title">
                        <span class="card-icon">📋</span>
                        Alert Details
                    </div>
                    <div id="alerts-list">
                        <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            No active alerts at this time.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Protection Plans Section -->
            <div class="content-section" id="protection-section">
                <div class="header">
                    <h1 class="header-title">Protection Plans</h1>
                </div>

                <div class="cards-grid">
                    <div class="card" style="border: 2px solid var(--info);">
                        <div class="card-title">
                            <span class="card-icon">🥉</span>
                            Basic Protection
                        </div>
                        <div style="font-size: 32px; font-weight: bold; color: var(--primary); margin: 15px 0;">
                            $17.99<span style="font-size: 16px;">/mo</span>
                        </div>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li style="padding: 8px 0;">✅ Community alerts</li>
                            <li style="padding: 8px 0;">✅ GPS tracking</li>
                            <li style="padding: 8px 0;">✅ $200 recovery reward</li>
                            <li style="padding: 8px 0;">✅ 24/7 support</li>
                        </ul>
                        <button class="btn btn-primary" onclick="alert('Stripe checkout integration needed')">Select Plan</button>
                    </div>

                    <div class="card" style="border: 2px solid var(--warning);">
                        <div class="card-title">
                            <span class="card-icon">🥈</span>
                            Gold Protection
                        </div>
                        <div style="font-size: 32px; font-weight: bold; color: var(--primary); margin: 15px 0;">
                            $24.99<span style="font-size: 16px;">/mo</span>
                        </div>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li style="padding: 8px 0;">✅ All Basic features</li>
                            <li style="padding: 8px 0;">✅ Priority alerts</li>
                            <li style="padding: 8px 0;">✅ $300 recovery reward</li>
                            <li style="padding: 8px 0;">✅ Insurance integration</li>
                        </ul>
                        <button class="btn btn-primary" onclick="alert('Stripe checkout integration needed')">Select Plan</button>
                    </div>

                    <div class="card" style="border: 2px solid #c0c0c0;">
                        <div class="card-title">
                            <span class="card-icon">🥇</span>
                            Platinum Protection
                        </div>
                        <div style="font-size: 32px; font-weight: bold; color: var(--primary); margin: 15px 0;">
                            $29.99<span style="font-size: 16px;">/mo</span>
                        </div>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li style="padding: 8px 0;">✅ All Gold features</li>
                            <li style="padding: 8px 0;">✅ Real-time tracking</li>
                            <li style="padding: 8px 0;">✅ $500 recovery reward</li>
                            <li style="padding: 8px 0;">✅ Carfax integration</li>
                        </ul>
                        <button class="btn btn-primary" onclick="alert('Stripe checkout integration needed')">Select Plan</button>
                    </div>

                    <div class="card" style="border: 2px solid var(--primary);">
                        <div class="card-title">
                            <span class="card-icon">💎</span>
                            Diamond Protection
                        </div>
                        <div style="font-size: 32px; font-weight: bold; color: var(--primary); margin: 15px 0;">
                            $35.00<span style="font-size: 16px;">/mo</span>
                        </div>
                        <ul style="list-style: none; padding: 0; color: var(--text-secondary);">
                            <li style="padding: 8px 0;">✅ All Platinum features</li>
                            <li style="padding: 8px 0;">✅ Instant alerts</li>
                            <li style="padding: 8px 0;">✅ $750 recovery reward</li>
                            <li style="padding: 8px 0;">✅ Dedicated support</li>
                        </ul>
                        <button class="btn btn-primary" onclick="alert('Stripe checkout integration needed')">Select Plan</button>
                    </div>
                </div>
            </div>

            <!-- Settings, Insurance, Analytics sections - keeping original structure -->
            <div class="content-section" id="settings-section">
                <div class="header">
                    <h1 class="header-title">Account Settings</h1>
                </div>
                <div class="card">
                    <div class="card-title">
                        <span class="card-icon">👤</span>
                        Profile Information
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="settings-email" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Member Since</label>
                        <input type="text" class="form-input" id="member-since" readonly>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Vehicle Modal with Comprehensive Dropdowns -->
    <div class="modal" id="add-vehicle-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Vehicle</h2>
                <button class="close-modal" onclick="closeAddVehicleModal()">&times;</button>
            </div>
            <form id="add-vehicle-form">
                <div class="form-group">
                    <label class="form-label">Year *</label>
                    <select class="form-select" id="add-year" required>
                        <option value="">Select Year</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Make *</label>
                    <select class="form-select" id="add-make" required onchange="updateModels()">
                        <option value="">Select Make</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Model *</label>
                    <select class="form-select" id="add-model" required>
                        <option value="">Select Make First</option>
                    </select>
                    <div class="form-helper">Select "Other/Custom" for special or custom vehicles</div>
                </div>

                <div class="form-group" id="custom-model-group" style="display: none;">
                    <label class="form-label">Custom Model Name *</label>
                    <input type="text" class="form-input" id="custom-model" placeholder="Enter custom model (e.g., GT-R Nismo, Custom Build)">
                </div>

                <div class="form-group">
                    <label class="form-label">Color *</label>
                    <input type="text" class="form-input" id="add-color" required placeholder="e.g., Silver, Midnight Blue">
                </div>

                <div class="form-group">
                    <label class="form-label">License Plate *</label>
                    <input type="text" class="form-input" id="add-plate" required placeholder="ABC123" style="text-transform: uppercase;">
                </div>

                <div class="form-group">
                    <label class="form-label">VIN (Optional)</label>
                    <input type="text" class="form-input" id="add-vin" maxlength="17" placeholder="17-digit VIN number">
                    <div class="form-helper">Vehicle Identification Number - helps with verification</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Custom Details (Optional)</label>
                    <textarea class="form-textarea" id="add-custom-details" placeholder="Add custom details like:
• Custom wheels (Forgiato, BBS, HRE, etc.)
• Body modifications (carbon fiber wing, widebody kit, etc.)
• Performance upgrades (turbo, supercharger, exhaust, etc.)
• Paint/Wrap details (chrome wrap, matte finish, custom color)
• Interior modifications
• Any unique identifiers"></textarea>
                    <div class="form-helper">Include any modifications or unique features that help identify your vehicle</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Protection Plan *</label>
                    <select class="form-select" id="add-plan" required>
                        <option value="basic">Basic - $17.99/mo</option>
                        <option value="gold">Gold - $24.99/mo</option>
                        <option value="platinum">Platinum - $29.99/mo</option>
                        <option value="diamond">Diamond - $35.00/mo</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary">Add Vehicle</button>
            </form>
        </div>
    </div>

    <!-- Edit Vehicle Modal -->
    <div class="modal" id="edit-vehicle-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Vehicle</h2>
                <button class="close-modal" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="edit-vehicle-form">
                <input type="hidden" id="edit-vehicle-id">
                
                <div class="form-group">
                    <label class="form-label">VIN (Optional)</label>
                    <input type="text" class="form-input" id="edit-vin" maxlength="17" placeholder="Enter 17-digit VIN">
                </div>

                <div class="form-group">
                    <label class="form-label">Custom Details</label>
                    <textarea class="form-textarea" id="edit-custom-details" placeholder="Add or update custom details"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Protection Plan</label>
                    <select class="form-select" id="edit-plan" required>
                        <option value="basic">Basic - $17.99/mo</option>
                        <option value="gold">Gold - $24.99/mo</option>
                        <option value="platinum">Platinum - $29.99/mo</option>
                        <option value="diamond">Diamond - $35.00/mo</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">License Plate</label>
                    <input type="text" class="form-input" id="edit-plate" readonly>
                </div>

                <div class="form-group">
                    <label class="form-label">Vehicle</label>
                    <input type="text" class="form-input" id="edit-vehicle-display" readonly>
                </div>

                <button type="submit" class="btn btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <script>
        // Vehicle Makes and Models Database (1990-2026)
        const vehicleDatabase = {
            'Acura': ['CL', 'CSX', 'EL', 'ILX', 'Integra', 'Legend', 'MDX', 'NSX', 'RDX', 'RL', 'RLX', 'RSX', 'SLX', 'TL', 'TLX', 'TSX', 'Vigor', 'ZDX', 'Other/Custom'],
            'Alfa Romeo': ['147', '156', '159', '164', '166', '4C', 'Brera', 'GTV', 'Giulia', 'Giulietta', 'MiTo', 'Spider', 'Stelvio', 'Tonale', 'Other/Custom'],
            'Aston Martin': ['DB7', 'DB9', 'DB11', 'DB12', 'DBS', 'DBX', 'Lagonda', 'Rapide', 'V12 Vantage', 'V8 Vantage', 'Vanquish', 'Vantage', 'Virage', 'Other/Custom'],
            'Audi': ['100', '200', '80', '90', 'A1', 'A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'Allroad', 'Cabriolet', 'Coupe', 'E-tron', 'Q3', 'Q4 e-tron', 'Q5', 'Q7', 'Q8', 'R8', 'RS3', 'RS4', 'RS5', 'RS6', 'RS7', 'RS Q8', 'S3', 'S4', 'S5', 'S6', 'S7', 'S8', 'SQ5', 'SQ7', 'SQ8', 'TT', 'Other/Custom'],
            'Bentley': ['Arnage', 'Azure', 'Bentayga', 'Brooklands', 'Continental', 'Flying Spur', 'Mulsanne', 'Turbo R', 'Other/Custom'],
            'BMW': ['1 Series', '2 Series', '3 Series', '4 Series', '5 Series', '6 Series', '7 Series', '8 Series', 'i3', 'i4', 'i5', 'i7', 'i8', 'iX', 'M2', 'M3', 'M4', 'M5', 'M6', 'M8', 'X1', 'X2', 'X3', 'X4', 'X5', 'X6', 'X7', 'XM', 'Z3', 'Z4', 'Z8', 'Other/Custom'],
            'Buick': ['Century', 'Enclave', 'Encore', 'Envision', 'LaCrosse', 'LeSabre', 'Lucerne', 'Park Avenue', 'Rainier', 'Reatta', 'Regal', 'Rendezvous', 'Riviera', 'Roadmaster', 'Skylark', 'Terraza', 'Verano', 'Other/Custom'],
            'Cadillac': ['ATS', 'Allante', 'BLS', 'CT4', 'CT5', 'CT6', 'CTS', 'Catera', 'Cimarron', 'DTS', 'DeVille', 'ELR', 'Eldorado', 'Escalade', 'Fleetwood', 'Lyriq', 'SRX', 'STS', 'Seville', 'XLR', 'XT4', 'XT5', 'XT6', 'XTS', 'Other/Custom'],
            'Chevrolet': ['Astro', 'Avalanche', 'Aveo', 'Blazer', 'Bolt', 'Camaro', 'Caprice', 'Captiva', 'Cavalier', 'Cobalt', 'Colorado', 'Corvette', 'Cruze', 'Equinox', 'Express', 'HHR', 'Impala', 'Lumina', 'Malibu', 'Monte Carlo', 'S10', 'SSR', 'Silverado', 'Sonic', 'Spark', 'Suburban', 'Tahoe', 'Tracker', 'TrailBlazer', 'Traverse', 'Trax', 'Uplander', 'Venture', 'Volt', 'Other/Custom'],
            'Chrysler': ['200', '300', '300M', 'Aspen', 'Cirrus', 'Concorde', 'Conquest', 'Crossfire', 'Imperial', 'Intrepid', 'LHS', 'LeBaron', 'New Yorker', 'PT Cruiser', 'Pacifica', 'Prowler', 'Sebring', 'Town & Country', 'Voyager', 'Other/Custom'],
            'Dodge': ['Avenger', 'Caliber', 'Caravan', 'Challenger', 'Charger', 'Colt', 'Dakota', 'Dart', 'Durango', 'Grand Caravan', 'Intrepid', 'Journey', 'Magnum', 'Neon', 'Nitro', 'Ram', 'Shadow', 'Spirit', 'Sprinter', 'Stealth', 'Stratus', 'Viper', 'Other/Custom'],
            'Ferrari': ['208', '288 GTO', '308', '328', '348', '360', '430', '456', '458', '488', '512', '550', '575M', '599', '612', 'California', 'Enzo', 'F12', 'F355', 'F40', 'F430', 'F50', 'F8', 'FF', 'LaFerrari', 'Portofino', 'Roma', 'SF90', 'Testarossa', 'Other/Custom'],
            'Fiat': ['124', '500', '500L', '500X', 'Brava', 'Bravo', 'Cinquecento', 'Coupe', 'Marea', 'Multipla', 'Panda', 'Punto', 'Seicento', 'Stilo', 'Tipo', 'Ulysse', 'Uno', 'Other/Custom'],
            'Ford': ['Aerostar', 'Aspire', 'Bronco', 'C-Max', 'Contour', 'Crown Victoria', 'E-Series', 'EcoSport', 'Edge', 'Escape', 'Escort', 'Excursion', 'Expedition', 'Explorer', 'F-150', 'F-250', 'F-350', 'Fairmont', 'Fiesta', 'Five Hundred', 'Flex', 'Focus', 'Freestar', 'Freestyle', 'Fusion', 'GT', 'Maverick', 'Mustang', 'Probe', 'Ranger', 'Taurus', 'Taurus X', 'Tempo', 'Thunderbird', 'Transit', 'Windstar', 'Other/Custom'],
            'Genesis': ['G70', 'G80', 'G90', 'GV60', 'GV70', 'GV80', 'Other/Custom'],
            'GMC': ['Acadia', 'Canyon', 'Envoy', 'Hummer EV', 'Jimmy', 'Safari', 'Savana', 'Sierra', 'Sonoma', 'Suburban', 'Terrain', 'Typhoon', 'Yukon', 'Other/Custom'],
            'Honda': ['Accord', 'CR-V', 'CR-Z', 'Civic', 'Clarity', 'Crosstour', 'Del Sol', 'Element', 'Fit', 'HR-V', 'Insight', 'Legend', 'Odyssey', 'Passport', 'Pilot', 'Prelude', 'Ridgeline', 'S2000', 'Other/Custom'],
            'Hummer': ['H1', 'H2', 'H3', 'Other/Custom'],
            'Hyundai': ['Accent', 'Azera', 'Elantra', 'Entourage', 'Equus', 'Excel', 'Genesis', 'Ioniq', 'Kona', 'Nexo', 'Palisade', 'Santa Cruz', 'Santa Fe', 'Scoupe', 'Sonata', 'Tiburon', 'Tucson', 'Veloster', 'Venue', 'Veracruz', 'XG', 'Other/Custom'],
            'Infiniti': ['EX', 'FX', 'G20', 'G35', 'G37', 'I30', 'I35', 'J30', 'JX', 'M', 'Q30', 'Q40', 'Q45', 'Q50', 'Q60', 'Q70', 'QX30', 'QX4', 'QX50', 'QX55', 'QX56', 'QX60', 'QX70', 'QX80', 'Other/Custom'],
            'Isuzu': ['Amigo', 'Ascender', 'Axiom', 'Hombre', 'I-280', 'I-290', 'I-350', 'I-370', 'Impulse', 'Oasis', 'Rodeo', 'Stylus', 'Trooper', 'VehiCROSS', 'Other/Custom'],
            'Jaguar': ['E-Pace', 'E-Type', 'F-Pace', 'F-Type', 'I-Pace', 'S-Type', 'X-Type', 'XE', 'XF', 'XJ', 'XJ12', 'XJ6', 'XJ8', 'XJR', 'XJS', 'XK', 'XK8', 'XKR', 'Other/Custom'],
            'Jeep': ['Cherokee', 'Commander', 'Compass', 'Gladiator', 'Grand Cherokee', 'Grand Wagoneer', 'Liberty', 'Patriot', 'Renegade', 'Wagoneer', 'Wrangler', 'Other/Custom'],
            'Kia': ['Amanti', 'Borrego', 'Cadenza', 'Carnival', 'EV6', 'Forte', 'K5', 'K900', 'Niro', 'Optima', 'Rio', 'Rondo', 'Sedona', 'Sephia', 'Sorento', 'Soul', 'Spectra', 'Sportage', 'Stinger', 'Telluride', 'Other/Custom'],
            'Lamborghini': ['Aventador', 'Countach', 'Diablo', 'Gallardo', 'Huracan', 'Murcielago', 'Revuelto', 'Urus', 'Other/Custom'],
            'Land Rover': ['Defender', 'Discovery', 'Discovery Sport', 'Freelander', 'LR2', 'LR3', 'LR4', 'Range Rover', 'Range Rover Evoque', 'Range Rover Sport', 'Range Rover Velar', 'Other/Custom'],
            'Lexus': ['CT', 'ES', 'GS', 'GX', 'HS', 'IS', 'LC', 'LFA', 'LS', 'LX', 'NX', 'RC', 'RX', 'RZ', 'SC', 'UX', 'Other/Custom'],
            'Lincoln': ['Aviator', 'Blackwood', 'Continental', 'Corsair', 'LS', 'MKC', 'MKS', 'MKT', 'MKX', 'MKZ', 'Mark LT', 'Mark VII', 'Mark VIII', 'Nautilus', 'Navigator', 'Town Car', 'Zephyr', 'Other/Custom'],
            'Lotus': ['Elan', 'Elise', 'Emira', 'Esprit', 'Evora', 'Exige', 'Other/Custom'],
            'Maserati': ['Biturbo', 'Coupe', 'Ghibli', 'GranSport', 'GranTurismo', 'Grecale', 'Levante', 'MC20', 'Quattroporte', 'Spyder', 'Other/Custom'],
            'Mazda': ['2', '3', '323', '5', '6', '626', '929', 'B-Series', 'CX-3', 'CX-30', 'CX-5', 'CX-50', 'CX-7', 'CX-9', 'CX-90', 'Millenia', 'Miata', 'MPV', 'MX-3', 'MX-5', 'MX-30', 'MX-6', 'Navajo', 'Protege', 'RX-7', 'RX-8', 'Tribute', 'Other/Custom'],
            'McLaren': ['540C', '570S', '600LT', '650S', '675LT', '720S', '765LT', 'Artura', 'GT', 'MP4-12C', 'P1', 'Senna', 'Speedtail', 'Other/Custom'],
            'Mercedes-Benz': ['190', '260', '300', '400', '420', '500', '560', '600', 'A-Class', 'AMG GT', 'B-Class', 'C-Class', 'CL-Class', 'CLA', 'CLC', 'CLK', 'CLS', 'E-Class', 'EQB', 'EQC', 'EQE', 'EQS', 'G-Class', 'GL-Class', 'GLA', 'GLB', 'GLC', 'GLE', 'GLK', 'GLS', 'M-Class', 'Maybach', 'Metris', 'R-Class', 'S-Class', 'SL', 'SLC', 'SLK', 'SLR', 'SLS', 'Sprinter', 'Other/Custom'],
            'Mercury': ['Capri', 'Cougar', 'Grand Marquis', 'Marauder', 'Mariner', 'Milan', 'Montego', 'Monterey', 'Mountaineer', 'Mystique', 'Sable', 'Topaz', 'Tracer', 'Villager', 'Other/Custom'],
            'Mini': ['Clubman', 'Convertible', 'Countryman', 'Coupe', 'Hardtop', 'Paceman', 'Roadster', 'Other/Custom'],
            'Mitsubishi': ['3000GT', 'Diamante', 'Eclipse', 'Endeavor', 'Evolution', 'Expo', 'Galant', 'I-MiEV', 'Lancer', 'Mirage', 'Montero', 'Montero Sport', 'Outlander', 'Outlander Sport', 'Precis', 'Raider', 'Sigma', 'Starion', 'Van', 'Other/Custom'],
            'Nissan': ['200SX', '240SX', '280ZX', '300ZX', '350Z', '370Z', 'Altima', 'Armada', 'Ariya', 'Axxess', 'Cube', 'Frontier', 'GT-R', 'Juke', 'Kicks', 'Leaf', 'Maxima', 'Murano', 'NV', 'Pathfinder', 'Quest', 'Rogue', 'Sentra', 'Stanza', 'Titan', 'Versa', 'Xterra', 'Z', 'Other/Custom'],
            'Oldsmobile': ['88', '98', 'Achieva', 'Alero', 'Aurora', 'Bravada', 'Cutlass', 'Intrigue', 'LSS', 'Regency', 'Silhouette', 'Toronado', 'Other/Custom'],
            'Peugeot': ['106', '107', '108', '205', '206', '207', '208', '2008', '3008', '306', '307', '308', '405', '406', '407', '5008', '505', '508', '605', '607', '806', '807', 'Bipper', 'Expert', 'Partner', 'RCZ', 'Rifter', 'Other/Custom'],
            'Plymouth': ['Acclaim', 'Breeze', 'Grand Voyager', 'Laser', 'Neon', 'Prowler', 'Sundance', 'Voyager', 'Other/Custom'],
            'Pontiac': ['Aztec', 'Bonneville', 'Fiero', 'Firebird', 'G3', 'G5', 'G6', 'G8', 'GTO', 'Grand Am', 'Grand Prix', 'LeMans', 'Montana', 'Solstice', 'Sunbird', 'Sunfire', 'Torrent', 'Trans Sport', 'Vibe', 'Other/Custom'],
            'Porsche': ['911', '918', '924', '928', '944', '968', 'Boxster', 'Carrera GT', 'Cayenne', 'Cayman', 'Macan', 'Panamera', 'Taycan', 'Other/Custom'],
            'Ram': ['1500', '2500', '3500', 'ProMaster', 'Other/Custom'],
            'Renault': ['Clio', 'Espace', 'Fluence', 'Kadjar', 'Kangoo', 'Koleos', 'Laguna', 'Megane', 'Safrane', 'Scenic', 'Talisman', 'Twingo', 'Vel Satis', 'Zoe', 'Other/Custom'],
            'Rolls-Royce': ['Corniche', 'Cullinan', 'Dawn', 'Ghost', 'Phantom', 'Silver Seraph', 'Silver Spur', 'Spectre', 'Wraith', 'Other/Custom'],
            'Saab': ['9-2X', '9-3', '9-4X', '9-5', '9-7X', '900', '9000', 'Other/Custom'],
            'Saturn': ['Astra', 'Aura', 'Ion', 'L-Series', 'Outlook', 'Relay', 'SC', 'SL', 'SW', 'Sky', 'Vue', 'Other/Custom'],
            'Scion': ['FR-S', 'iA', 'iM', 'iQ', 'tC', 'xA', 'xB', 'xD', 'Other/Custom'],
            'Smart': ['Fortwo', 'Forfour', 'Other/Custom'],
            'Subaru': ['Ascent', 'B9 Tribeca', 'Baja', 'BRZ', 'Crosstrek', 'Forester', 'Impreza', 'Justy', 'Legacy', 'Loyale', 'Outback', 'SVX', 'Solterra', 'Tribeca', 'WRX', 'XT', 'XV Crosstrek', 'Other/Custom'],
            'Suzuki': ['Aerio', 'Equator', 'Esteem', 'Forenza', 'Grand Vitara', 'Kizashi', 'Reno', 'Samurai', 'Sidekick', 'Swift', 'SX4', 'Verona', 'Vitara', 'X-90', 'XL7', 'Other/Custom'],
            'Tesla': ['Cybertruck', 'Model 3', 'Model S', 'Model X', 'Model Y', 'Roadster', 'Other/Custom'],
            'Toyota': ['4Runner', '86', 'Avalon', 'bZ4X', 'C-HR', 'Camry', 'Celica', 'Corolla', 'Corona', 'Cressida', 'Crown', 'Echo', 'FJ Cruiser', 'GR Corolla', 'GR Supra', 'GR86', 'Highlander', 'Land Cruiser', 'Matrix', 'MR2', 'Mirai', 'Paseo', 'Pickup', 'Previa', 'Prius', 'RAV4', 'Sequoia', 'Sienna', 'Solara', 'Supra', 'T100', 'Tacoma', 'Tercel', 'Tundra', 'Venza', 'Yaris', 'Other/Custom'],
            'Volkswagen': ['Arteon', 'Atlas', 'Beetle', 'CC', 'Cabrio', 'Cabriolet', 'Corrado', 'Eos', 'Eurovan', 'Fox', 'GTI', 'Golf', 'ID.4', 'Jetta', 'Passat', 'Phaeton', 'Rabbit', 'Routan', 'Scirocco', 'Taos', 'Tiguan', 'Touareg', 'Vanagon', 'Other/Custom'],
            'Volvo': ['240', '740', '760', '780', '850', '940', '960', 'C30', 'C40', 'C70', 'S40', 'S60', 'S70', 'S80', 'S90', 'V40', 'V50', 'V60', 'V70', 'V90', 'XC40', 'XC60', 'XC70', 'XC90', 'Other/Custom'],
            'Other/Custom': ['Custom Build', 'Kit Car', 'Modified Vehicle', 'Specialty Vehicle', 'Classic/Vintage', 'Exotic/Rare', 'Other']
        };

        // Populate year dropdown (1990-2026)
        function populateYears() {
            const yearSelect = document.getElementById('add-year');
            const currentYear = new Date().getFullYear();
            for (let year = 2026; year >= 1990; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }

        // Populate makes dropdown
        function populateMakes() {
            const makeSelect = document.getElementById('add-make');
            const makes = Object.keys(vehicleDatabase).sort();
            makes.forEach(make => {
                const option = document.createElement('option');
                option.value = make;
                option.textContent = make;
                makeSelect.appendChild(option);
            });
        }

        // Update models based on selected make
        function updateModels() {
            const make = document.getElementById('add-make').value;
            const modelSelect = document.getElementById('add-model');
            const customModelGroup = document.getElementById('custom-model-group');
            
            // Clear existing options
            modelSelect.innerHTML = '<option value="">Select Model</option>';
            
            if (make && vehicleDatabase[make]) {
                vehicleDatabase[make].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
            }

            // Show/hide custom model input
            modelSelect.addEventListener('change', function() {
                if (this.value === 'Other/Custom') {
                    customModelGroup.style.display = 'block';
                    document.getElementById('custom-model').required = true;
                } else {
                    customModelGroup.style.display = 'none';
                    document.getElementById('custom-model').required = false;
                }
            });
        }

        // Initialize dropdowns on page load
        document.addEventListener('DOMContentLoaded', () => {
            populateYears();
            populateMakes();
            
            // Update sync status
            setTimeout(() => {
                document.getElementById('sync-status').textContent = '✅ Community network connected';
                document.getElementById('sync-status').style.color = 'var(--success)';
            }, 2000);
        });

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            document.getElementById(sectionId + '-section').classList.add('active');
            event.target.closest('.nav-link').classList.add('active');

            if (sectionId === 'map-alerts' && !map) {
                setTimeout(initializeMap, 100);
            }
        }

        // Initialize Map
        let map = null;
        function initializeMap() {
            if (map) return;
            const defaultLat = 26.1420;
            const defaultLng = -81.7948;
            map = L.map('map').setView([defaultLat, defaultLng], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);
        }

        // Vehicle Management
        function updateVehicleDisplay() {
            const vehicleList = document.getElementById('vehicle-list');
            
            if (!window.userVehicles || window.userVehicles.length === 0) {
                vehicleList.innerHTML = `
                    <p style="text-align: center; color: var(--text-secondary); padding: 40px;">
                        No vehicles added yet. Click "Add Vehicle" to get started!
                    </p>
                `;
                return;
            }

            vehicleList.innerHTML = window.userVehicles.map(vehicle => `
                <div class="vehicle-card">
                    <div class="vehicle-header">
                        <div class="vehicle-info">
                            <h3>${vehicle.year} ${vehicle.make} ${vehicle.model}</h3>
                            <p style="color: var(--text-secondary);">${vehicle.color}</p>
                            ${vehicle.customDetails ? `<p style="color: var(--info); font-size: 13px; margin-top: 5px;">🎨 Custom: ${vehicle.customDetails.substring(0, 100)}...</p>` : ''}
                        </div>
                        <div class="vehicle-actions">
                            <button class="btn-small btn-edit" onclick="openEditModal('${vehicle.id}')">
                                ✏️ Edit
                            </button>
                            <button class="btn-small btn-delete" onclick="deleteVehicle('${vehicle.id}')">
                                🗑️ Delete
                            </button>
                        </div>
                    </div>
                    <div class="vehicle-details">
                        <div class="detail-item">
                            <span class="detail-label">License Plate</span>
                            <span>${vehicle.licensePlate}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">VIN</span>
                            <span>${vehicle.vin || 'Not provided'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Protection Plan</span>
                            <span style="color: var(--primary); font-weight: bold; text-transform: capitalize;">
                                ${vehicle.plan || 'Basic'}
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status</span>
                            <span style="color: var(--success); font-weight: bold;">
                                ✅ Protected
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateVehicleCount() {
            const count = window.userVehicles ? window.userVehicles.length : 0;
            document.getElementById('vehicle-count').textContent = count;
        }

        // Modal Functions
        function showAddVehicleModal() {
            document.getElementById('add-vehicle-modal').classList.add('active');
        }

        function closeAddVehicleModal() {
            document.getElementById('add-vehicle-modal').classList.remove('active');
            document.getElementById('add-vehicle-form').reset();
            document.getElementById('custom-model-group').style.display = 'none';
        }

        function openEditModal(vehicleId) {
            const vehicle = window.userVehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;

            document.getElementById('edit-vehicle-id').value = vehicle.id;
            document.getElementById('edit-vin').value = vehicle.vin || '';
            document.getElementById('edit-custom-details').value = vehicle.customDetails || '';
            document.getElementById('edit-plan').value = vehicle.plan || 'basic';
            document.getElementById('edit-plate').value = vehicle.licensePlate;
            document.getElementById('edit-vehicle-display').value = 
                `${vehicle.year} ${vehicle.make} ${vehicle.model} - ${vehicle.color}`;

            document.getElementById('edit-vehicle-modal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('edit-vehicle-modal').classList.remove('active');
        }

        async function deleteVehicle(vehicleId) {
            if (!confirm('Are you sure you want to delete this vehicle? This cannot be undone.')) {
                return;
            }

            if (!window.currentUser) {
                alert('Please log in to delete vehicles');
                return;
            }

            try {
                const vehicleRef = window.firebaseRef(
                    window.firebaseDatabase, 
                    `vehicles/${window.currentUser.uid}/${vehicleId}`
                );
                
                await window.firebaseRemove(vehicleRef);
                alert('✅ Vehicle deleted successfully!');
            } catch (error) {
                console.error('Error deleting vehicle:', error);
                alert('❌ Error deleting vehicle. Please try again.');
            }
        }

        // Handle Add Vehicle Form Submission
        document.getElementById('add-vehicle-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!window.currentUser) {
                alert('Please log in to add vehicles');
                return;
            }

            const year = document.getElementById('add-year').value;
            const make = document.getElementById('add-make').value;
            let model = document.getElementById('add-model').value;
            const color = document.getElementById('add-color').value.trim();
            const licensePlate = document.getElementById('add-plate').value.trim().toUpperCase();
            const vin = document.getElementById('add-vin').value.trim();
            const customDetails = document.getElementById('add-custom-details').value.trim();
            const plan = document.getElementById('add-plan').value;

            // Use custom model if "Other/Custom" was selected
            if (model === 'Other/Custom') {
                const customModel = document.getElementById('custom-model').value.trim();
                if (!customModel) {
                    alert('Please enter a custom model name');
                    return;
                }
                model = customModel;
            }

            try {
                const vehiclesRef = window.firebaseRef(
                    window.firebaseDatabase, 
                    `vehicles/${window.currentUser.uid}`
                );
                
                const newVehicleRef = window.firebasePush(vehiclesRef);
                
                await window.firebaseSet(newVehicleRef, {
                    id: newVehicleRef.key,
                    year: year,
                    make: make,
                    model: model,
                    color: color,
                    licensePlate: licensePlate,
                    vin: vin,
                    customDetails: customDetails,
                    plan: plan,
                    stolen: false,
                    createdAt: Date.now(),
                    updatedAt: Date.now()
                });

                alert('✅ Vehicle added successfully!');
                closeAddVehicleModal();
                
            } catch (error) {
                console.error('Error adding vehicle:', error);
                alert('❌ Error adding vehicle. Please try again.');
            }
        });

        // Handle Edit Vehicle Form Submission
        document.getElementById('edit-vehicle-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const vehicleId = document.getElementById('edit-vehicle-id').value;
            const vin = document.getElementById('edit-vin').value.trim();
            const customDetails = document.getElementById('edit-custom-details').value.trim();
            const plan = document.getElementById('edit-plan').value;

            if (!window.currentUser) {
                alert('Please log in to edit vehicles');
                return;
            }

            try {
                const vehicleRef = window.firebaseRef(
                    window.firebaseDatabase, 
                    `vehicles/${window.currentUser.uid}/${vehicleId}`
                );
                
                await window.firebaseUpdate(vehicleRef, {
                    vin: vin,
                    customDetails: customDetails,
                    plan: plan,
                    updatedAt: Date.now()
                });

                alert('✅ Vehicle updated successfully!');
                closeEditModal();
                
            } catch (error) {
                console.error('Error updating vehicle:', error);
                alert('❌ Error updating vehicle. Please try again.');
            }
        });

        // Sign Out
        function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                if (window.firebaseSignOut && window.firebaseAuth) {
                    window.firebaseSignOut(window.firebaseAuth).then(() => {
                        localStorage.clear();
                        sessionStorage.clear();
                        window.location.href = 'cartrace_homepage.html';
                    }).catch((error) => {
                        console.error('Logout error:', error);
                        window.location.href = 'cartrace_homepage.html';
                    });
                } else {
                    window.location.href = 'cartrace_homepage.html';
                }
            }
        }
    </script>

    <!-- Firebase Module Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getDatabase, ref, set, get, push, remove, update, onValue, off } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB8iFriCB3kt4lWeXQUNj5LTsAXFZoXX0Y",
            authDomain: "cartrace-pro.firebaseapp.com",
            databaseURL: "https://cartrace-pro-default-rtdb.firebaseio.com/",
            projectId: "cartrace-pro",
            storageBucket: "cartrace-pro.firebasestorage.app",
            messagingSenderId: "341907523496",
            appId: "1:341907523496:web:f10a87930d939cf3b8ff9d",
            measurementId: "G-X01QW112CD"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        window.firebaseAuth = auth;
        window.firebaseDatabase = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebasePush = push;
        window.firebaseRemove = remove;
        window.firebaseUpdate = update;
        window.firebaseOnValue = onValue;
        window.firebaseOff = off;
        window.firebaseSignOut = signOut;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                window.currentUser = user;
                
                document.getElementById('user-email').textContent = user.email || 'User';
                document.getElementById('settings-email').value = user.email || 'user@example.com';
                document.getElementById('member-since').value = new Date(user.metadata.creationTime).toLocaleDateString();
                
                // Load vehicles with real-time updates
                const vehiclesRef = ref(database, `vehicles/${user.uid}`);
                onValue(vehiclesRef, (snapshot) => {
                    const data = snapshot.val();
                    
                    if (data) {
                        window.userVehicles = Object.keys(data).map(key => ({
                            ...data[key],
                            id: data[key].id || key
                        }));
                        localStorage.setItem('cartraceVehicles', JSON.stringify(window.userVehicles));
                    } else {
                        window.userVehicles = [];
                        localStorage.setItem('cartraceVehicles', JSON.stringify([]));
                    }
                    
                    updateVehicleDisplay();
                    updateVehicleCount();
                });
            } else {
                window.location.href = 'cartrace_homepage.html';
            }
        });
    </script>
</body>
</html>

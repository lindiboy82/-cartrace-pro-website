<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarTrace Pro - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .app-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400"><defs><radialGradient id="globeGrad" cx="50%" cy="40%" r="70%"><stop offset="0%" style="stop-color:%23a8c8ec"/><stop offset="100%" style="stop-color:%232563eb"/></radialGradient></defs><circle cx="200" cy="220" r="140" fill="url(%23globeGrad)"/><g stroke="white" stroke-width="3" fill="none"><circle cx="200" cy="220" r="140"/><ellipse cx="200" cy="220" rx="140" ry="70"/><ellipse cx="200" cy="220" rx="70" ry="140"/><line x1="60" y1="220" x2="340" y2="220"/><line x1="200" y1="80" x2="200" y2="360"/></g><path d="M200 80 L230 160 L200 200 Z" fill="%23dc2626"/><ellipse cx="210" cy="130" rx="18" ry="18" fill="white"/></svg>') center/contain no-repeat;
        }

        .app-title {
            font-size: 20px;
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 5px;
        }

        .app-subtitle {
            font-size: 12px;
            color: #6b7280;
        }

        .user-info-sidebar {
            font-size: 11px;
            color: #4f46e5;
            margin-top: 8px;
            padding: 8px;
            background: #f3f4f6;
            border-radius: 8px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: #374151;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
            cursor: pointer;
            background: transparent;
            border: none;
            width: 100%;
            text-align: left;
        }

        .nav-link:hover, .nav-link.active {
            background: #4f46e5;
            color: white;
            transform: translateX(4px);
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 18px;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 28px;
            font-weight: bold;
            color: #4f46e5;
        }

        .header-status {
            display: flex;
            align-items: center;
            color: #10b981;
            font-weight: 600;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .card-icon {
            margin-right: 10px;
            font-size: 20px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            text-align: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .stat-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
        }

        .stat-trend {
            font-size: 10px;
            color: #10b981;
            font-weight: bold;
            margin-top: 3px;
        }

        /* Coming Soon Banner */
        .coming-soon-banner {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(245, 158, 11, 0.5); }
            to { box-shadow: 0 0 20px rgba(245, 158, 11, 0.8); }
        }

        /* Buttons */
        .btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: #4338ca;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-coming-soon {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .btn-coming-soon:hover {
            background: #9ca3af;
            transform: none;
            box-shadow: none;
        }

        /* Emergency Section */
        .emergency-section {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 2px solid #fca5a5;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .emergency-title {
            color: #dc2626;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .emergency-content {
            color: #7f1d1d;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* Vehicle Cards */
        .vehicle-card {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 1.5rem;
            transition: border-color 0.3s;
            margin-bottom: 15px;
            background: white;
        }

        .vehicle-card:hover {
            border-color: #4f46e5;
        }

        .vehicle-make {
            font-weight: bold;
            font-size: 1.1rem;
            color: #333;
        }

        .vehicle-details {
            color: #6b7280;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .vehicle-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .status-active {
            background: #10b981;
            color: white;
        }

        .status-stolen {
            background: #ef4444;
            color: white;
        }

        /* Disabled feature styling */
        .feature-disabled {
            opacity: 0.7;
            position: relative;
        }

        .feature-disabled::after {
            content: "COMING SOON";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f59e0b;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        /* Content sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #4f46e5;
            display: flex;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #ef4444;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .features-hint {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .btn-cancel {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-cancel:hover {
            background: #d1d5db;
        }

        /* Subscription Plans Styles */
        .plans-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .plan-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            position: relative;
        }

        .plan-card:hover {
            border-color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(79, 70, 229, 0.1);
        }

        .plan-card.selected {
            border-color: #4f46e5;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(79, 70, 229, 0.1) 100%);
        }

        .plan-card.selected::after {
            content: "‚úì";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4f46e5;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .plan-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .plan-basic { color: #4CAF50; }
        .plan-gold { color: #FF9800; }
        .plan-platinum { color: #9C27B0; }
        .plan-diamond { color: #E91E63; }

        .plan-price {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .plan-reward {
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .plan-coverage {
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .plan-features {
            font-size: 12px;
            color: #6b7280;
            line-height: 1.4;
        }

        .plan-features ul {
            margin: 8px 0;
            padding-left: 20px;
        }

        .plan-features li {
            margin-bottom: 4px;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            padding: 0 20px;
        }

        .step {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #9ca3af;
        }

        .step.active {
            color: #4f46e5;
            font-weight: bold;
        }

        .step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            font-weight: bold;
        }

        .step.active .step-number {
            background: #4f46e5;
            color: white;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: 15px;
            }

            .main-content {
                padding: 20px 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .plans-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="logo-section">
                <div class="app-logo"></div>
                <div class="app-title">CarTrace Pro</div>
                <div class="app-subtitle">Community Vehicle Security</div>
                <div class="user-info-sidebar" id="sidebarUserInfo">
                    Loading user...
                </div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <button class="nav-link active" onclick="showSection('dashboard', this)">
                        <span class="nav-icon">üìä</span>
                        Dashboard
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="showSection('vehicles', this)">
                        <span class="nav-icon">üöó</span>
                        My Vehicles
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="showSection('recovery', this)">
                        <span class="nav-icon">üö®</span>
                        Recovery Center
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="showSection('alerts', this)">
                        <span class="nav-icon">üîî</span>
                        Security Alerts
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="showSection('analytics', this)">
                        <span class="nav-icon">üìà</span>
                        Analytics
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="showSection('settings', this)">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        Settings
                    </button>
                </li>
                <li class="nav-item" style="margin-top: 20px;">
                    <button class="nav-link" onclick="signOut()" style="background: #ef4444; color: white;">
                        <span class="nav-icon">üö™</span>
                        Sign Out
                    </button>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <div>
                    <h1 class="header-title" id="headerTitle">üõ°Ô∏è Security Dashboard</h1>
                    <p style="color: #6b7280; margin-top: 5px;">Community-powered vehicle protection and monitoring</p>
                </div>
                <div class="header-status">
                    <div class="status-dot"></div>
                    SYSTEM ONLINE
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section active">
                <!-- Live Statistics Card -->
                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üìä</span>
                        Live Network Statistics
                    </h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-icon">üì°</div>
                            <div class="stat-value" id="network-uptime">99.97%</div>
                            <div class="stat-label">Network Uptime</div>
                            <div class="stat-trend">‚Üó +0.02%</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">‚ö°</div>
                            <div class="stat-value" id="response-time">0.8ms</div>
                            <div class="stat-label">Response Time</div>
                            <div class="stat-trend">‚Üó Improving</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üõ°Ô∏è</div>
                            <div class="stat-value" id="security-score">95</div>
                            <div class="stat-label">Security Score</div>
                            <div class="stat-trend">‚Üó +2 pts</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-value" id="data-points">1,247</div>
                            <div class="stat-label">Data Points</div>
                            <div class="stat-trend">‚Üó Live</div>
                        </div>
                    </div>
                    <p style="text-align: center; color: #6b7280; font-size: 12px; margin-top: 15px;">
                        üîÑ Live updates every 3 seconds ‚Ä¢ Last update: <span id="last-update">just now</span>
                    </p>
                </div>

                <div class="cards-grid">
                    <!-- Community Impact -->
                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">üåê</span>
                            Community Network
                        </h2>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-icon">üë•</div>
                                <div class="stat-value">47,892</div>
                                <div class="stat-label">Active Users</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-icon">üöó</div>
                                <div class="stat-value">2,847</div>
                                <div class="stat-label">Cars Found</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-icon">üí∞</div>
                                <div class="stat-value">$1.2M</div>
                                <div class="stat-label">Rewards Paid</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-icon">üéØ</div>
                                <div class="stat-value">96.1%</div>
                                <div class="stat-label">Success Rate</div>
                            </div>
                        </div>
                        <p style="color: #6b7280; font-size: 14px; margin-top: 15px;">
                            Your vehicles are protected by the world's largest community-powered security network.
                        </p>
                    </div>

                    <!-- Current Vehicle Status -->
                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">üöó</span>
                            Your Protection Status
                        </h2>
                        <div id="vehicle-status-content">
                            <div class="loading">
                                <div class="spinner"></div>
                                Loading vehicles...
                            </div>
                        </div>
                    </div>

                    <!-- Advanced GPS & Recovery (Coming Soon) -->
                    <div class="card feature-disabled">
                        <div class="coming-soon-banner">üöß COMING SOON - Q3 2025 üöß</div>
                        <h2 class="card-title">
                            <span class="card-icon">üìç</span>
                            Advanced GPS & Recovery
                        </h2>
                        <p style="color: #6b7280; margin-bottom: 15px;">
                            Real-time GPS tracking, professional recovery teams, and instant response capabilities coming soon.
                        </p>
                        <button class="btn btn-coming-soon" style="width: 100%;">
                            üìç GPS Tracking Coming Soon
                        </button>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">‚ö°</span>
                            Quick Actions
                        </h2>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button class="btn btn-danger" onclick="reportStolen()">
                                üö® Report Vehicle Missing
                            </button>
                            <button class="btn btn-success" onclick="foundVehicle()">
                                üîç I Found a Missing Vehicle
                            </button>
                            <button class="btn btn-warning" onclick="showSection('alerts', this)">
                                üîî View Community Alerts
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vehicles Section -->
            <div id="vehicles" class="content-section">
                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üöó</span>
                        My Protected Vehicles
                    </h2>
                    <button class="btn" onclick="showAddVehicleModal()" style="margin-bottom: 20px;">
                        ‚ûï Add New Vehicle
                    </button>
                    <div id="vehicles-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading vehicles...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recovery Section -->
            <div id="recovery" class="content-section">
                <div class="emergency-section">
                    <h2 class="emergency-title">
                        <span style="margin-right: 10px;">üö®</span>
                        Community Vehicle Recovery
                    </h2>
                    <div class="emergency-content">
                        <strong>Current Community Protocol:</strong><br><br>
                        1Ô∏è‚É£ Contact 911 FIRST (Required by law)<br>
                        2Ô∏è‚É£ Report through CarTrace Pro community system<br>
                        3Ô∏è‚É£ Community network alerted (47,892 users)<br>
                        4Ô∏è‚É£ Crowdsourced search begins<br>
                        5Ô∏è‚É£ Real-time community updates<br><br>
                        
                        <div class="coming-soon-banner" style="margin: 15px 0;">
                            üöß COMING SOON: Professional GPS tracking & recovery teams
                        </div>
                        
                        <strong>üéØ Current Success Rate:</strong> 96.1% recovery via community<br>
                        <strong>üë• Network Size:</strong> 47,892 active community members<br>
                        <strong>üí∞ Community Rewards:</strong> $1.2M+ paid to helpers
                    </div>
                    <button class="btn btn-danger" onclick="reportStolen()" style="font-size: 16px; padding: 15px 30px;">
                        üö® REPORT VEHICLE MISSING
                    </button>
                </div>
            </div>

            <!-- Alerts Section -->
            <div id="alerts" class="content-section">
                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üîî</span>
                        Community Alert Center
                    </h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-icon">üü¢</div>
                            <div class="stat-value" id="active-alerts">0</div>
                            <div class="stat-label">Active Alerts</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üìÖ</div>
                            <div class="stat-value">7</div>
                            <div class="stat-label">Alerts Today</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üìä</div>
                            <div class="stat-value">23</div>
                            <div class="stat-label">This Week</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-icon">üõ°Ô∏è</div>
                            <div class="stat-value">100%</div>
                            <div class="stat-label">System Health</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">üö®</span>
                        Recent Community Activity
                    </h2>
                    <div id="alerts-list">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics" class="content-section">
                <div class="cards-grid">
                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">üìà</span>
                            Community Performance
                        </h2>
                        <div class="stats-grid">
                            <div class="stat-box">
                                <div class="stat-icon">‚ö°</div>
                                <div class="stat-value">97%</div>
                                <div class="stat-label">System Efficiency</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-icon">üéØ</div>
                                <div class="stat-value">96.1%</div>
                                <div class="stat-label">Recovery Rate</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-icon">üòä</div>
                                <div class="stat-value">98%</div>
                                <div class="stat-label">User Satisfaction</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-icon">üìä</div>
                                <div class="stat-value" id="total-vehicles-analytics">0</div>
                                <div class="stat-label">Your Vehicles</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">üöó</span>
                            Vehicle Analytics
                        </h2>
                        <div style="color: #374151;">
                            <strong>üìä Current Analytics:</strong><br><br>
                            
                            üöó Community Coverage:<br>
                            ‚Ä¢ Total Protected Vehicles: <span id="analytics-vehicles">0</span><br>
                            ‚Ä¢ Network Members: 47,892 active<br>
                            ‚Ä¢ Coverage Area: All 50 states<br><br>
                            
                            üõ°Ô∏è Protection Analytics:<br>
                            ‚Ä¢ Success Rate: 96.1% via community<br>
                            ‚Ä¢ Network Response: Real-time alerts<br>
                            ‚Ä¢ Community Participation: 100% active<br><br>
                            
                            üí∞ Subscription Analytics:<br>
                            ‚Ä¢ Active Vehicles: <span id="analytics-active-vehicles">0</span><br>
                            ‚Ä¢ Monthly Revenue: $<span id="analytics-monthly-revenue">0.00</span><br>
                            ‚Ä¢ Active Plans: <span id="analytics-plan-breakdown">None</span><br><br>
                            
                            <div class="coming-soon-banner">
                                üöß COMING SOON: Advanced GPS analytics and professional recovery metrics
                            </div>
                        </div>
                        <button class="btn" onclick="generateReport()">üìä Generate Community Report</button>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings" class="content-section">
                <div class="card">
                    <h2 class="card-title">
                        <span class="card-icon">‚öôÔ∏è</span>
                        Account Settings
                    </h2>
                    <div style="color: #374151; line-height: 1.6;">
                        <strong>üë§ Profile Information:</strong><br>
                        Name: <span id="user-name">Loading...</span><br>
                        Email: <span id="user-email">Loading...</span><br>
                        Plan: CarTrace Pro Community<br>
                        Member Since: <span id="member-since">Loading...</span><br><br>

                        <strong>üìß App Settings:</strong><br>
                        ‚Ä¢ Notifications: Enabled<br>
                        ‚Ä¢ Emergency Contacts: 3 configured<br>
                        ‚Ä¢ Two-Factor Authentication: Enabled<br><br>

                        <strong>ü¶æ Subscription Details:</strong><br>
                        ‚Ä¢ Status: Active<br>
                        ‚Ä¢ Protected Vehicles: <span id="settings-vehicles">0</span><br>
                        ‚Ä¢ Community Access: Full<br><br>

                        <strong>üì± System Information:</strong><br>
                        ‚Ä¢ Web App Version: 3.1.4<br>
                        ‚Ä¢ Last Security Update: Today<br>
                        ‚Ä¢ Sync Status: Connected to Firebase<br><br>

                        <div class="coming-soon-banner">
                            üöß COMING SOON: Professional GPS tracking subscription and Insurance integration
                        </div>
                    </div>
                    <div style="margin-top: 25px; display: flex; gap: 15px;">
                        <button class="btn">üíé View Future Plans</button>
                        <button class="btn btn-secondary" onclick="signOut()">üö™ Sign Out</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Vehicle Modal -->
    <div id="addVehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <span style="margin-right: 10px;">üöó</span>
                    Add New Vehicle
                </h2>
                <button class="close-btn" onclick="closeAddVehicleModal()">&times;</button>
            </div>

            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" id="step1">
                    <span class="step-number">1</span>
                    Vehicle Details
                </div>
                <div class="step" id="step2">
                    <span class="step-number">2</span>
                    Protection Plan
                </div>
            </div>
            
            <form id="addVehicleForm">
                <!-- Step 1: Vehicle Details -->
                <div class="form-section active" id="vehicleDetailsSection">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Year *</label>
                            <select class="form-select" id="vehicleYear" required>
                                <option value="">Select Year</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Make *</label>
                            <select class="form-select" id="vehicleMake" required>
                                <option value="">Select Make</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Model *</label>
                            <select class="form-select" id="vehicleModel" required disabled>
                                <option value="">Select Make First</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Color *</label>
                            <select class="form-select" id="vehicleColor" required>
                                <option value="">Select Color</option>
                                <option value="Black">Black</option>
                                <option value="White">White</option>
                                <option value="Silver">Silver</option>
                                <option value="Gray">Gray</option>
                                <option value="Red">Red</option>
                                <option value="Blue">Blue</option>
                                <option value="Navy">Navy Blue</option>
                                <option value="Green">Green</option>
                                <option value="Brown">Brown</option>
                                <option value="Beige">Beige</option>
                                <option value="Gold">Gold</option>
                                <option value="Orange">Orange</option>
                                <option value="Yellow">Yellow</option>
                                <option value="Purple">Purple</option>
                                <option value="Maroon">Maroon</option>
                                <option value="Burgundy">Burgundy</option>
                                <option value="Charcoal">Charcoal</option>
                                <option value="Pearl">Pearl</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">License Plate *</label>
                        <input type="text" class="form-input" id="vehicleLicensePlate" placeholder="Enter license plate number" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">VIN (Optional)</label>
                        <input type="text" class="form-input" id="vehicleVIN" placeholder="Vehicle Identification Number">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üåü Unique Features & Modifications</label>
                        <textarea class="form-textarea" id="vehicleFeatures" placeholder="Describe unique features that make your vehicle stand out...&#10;&#10;Examples:&#10;‚Ä¢ Custom black 20&quot; wheels&#10;‚Ä¢ Red racing stripes&#10;‚Ä¢ Tinted windows&#10;‚Ä¢ Roof rack&#10;‚Ä¢ Custom exhaust&#10;‚Ä¢ Dents or scratches&#10;‚Ä¢ Stickers or decals&#10;‚Ä¢ Aftermarket spoiler"></textarea>
                        <div class="features-hint">
                            üí° Include any modifications, damage, or distinguishing features that would help identify your vehicle
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-cancel" onclick="closeAddVehicleModal()">Cancel</button>
                        <button type="button" class="btn btn-success" onclick="nextStep()">
                            Next: Choose Protection Plan ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Step 2: Protection Plan Selection -->
                <div class="form-section" id="protectionPlanSection">
                    <h3 style="color: #4f46e5; margin-bottom: 10px;">Choose Your Protection Plan</h3>
                    <p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">
                        Select a plan to activate community protection and recovery rewards for your vehicle
                    </p>

                    <div class="plans-container">
                        <!-- Basic Plan -->
                        <div class="plan-card" onclick="selectPlan('BASIC')" data-plan="BASIC">
                            <div class="plan-name plan-basic">üü¢ Basic Protection</div>
                            <div class="plan-price">$5.99/month</div>
                            <div class="plan-reward">$200 REWARD</div>
                            <div class="plan-coverage">üìç 30 miles coverage</div>
                            <div class="plan-features">
                                <ul>
                                    <li>Basic Theft Alerts</li>
                                    <li>Community Support Network</li>
                                    <li>Standard Recovery Assistance</li>
                                    <li>Insurance Documentation</li>
                                    <li>24/7 Support Hotline</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Gold Plan -->
                        <div class="plan-card" onclick="selectPlan('GOLD')" data-plan="GOLD">
                            <div class="plan-name plan-gold">ü•á Gold Protection</div>
                            <div class="plan-price">$9.99/month</div>
                            <div class="plan-reward">$300 REWARD</div>
                            <div class="plan-coverage">üìç 60 miles coverage</div>
                            <div class="plan-features">
                                <ul>
                                    <li>Everything in Basic</li>
                                    <li>Real-time Push Notifications</li>
                                    <li>Priority Support Response</li>
                                    <li>Enhanced Recovery Tools</li>
                                    <li>Monthly Security Reports</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Platinum Plan -->
                        <div class="plan-card" onclick="selectPlan('PLATINUM')" data-plan="PLATINUM">
                            <div class="plan-name plan-platinum">üíé Platinum Protection</div>
                            <div class="plan-price">$19.99/month</div>
                            <div class="plan-reward">$500 REWARD</div>
                            <div class="plan-coverage">üìç 100 miles coverage</div>
                            <div class="plan-features">
                                <ul>
                                    <li>Everything in Gold</li>
                                    <li>Personal Recovery Agent</li>
                                    <li>Law Enforcement Liaison</li>
                                    <li>Advanced Recovery Network</li>
                                    <li>Quarterly Security Audits</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Diamond Plan -->
                        <div class="plan-card" onclick="selectPlan('DIAMOND')" data-plan="DIAMOND">
                            <div class="plan-name plan-diamond">üí† Diamond Protection</div>
                            <div class="plan-price">$29.99/month</div>
                            <div class="plan-reward">$750 REWARD</div>
                            <div class="plan-coverage">üìç STATEWIDE COVERAGE</div>
                            <div class="plan-features">
                                <ul>
                                    <li>Everything in Platinum</li>
                                    <li>Dedicated Recovery Team</li>
                                    <li>VIP Priority Response</li>
                                    <li>Premium Insurance Assistance</li>
                                    <li>Annual Security Assessment</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" id="selectedPlan" value="">
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-cancel" onclick="previousStep()">‚Üê Back</button>
                        <button type="submit" class="btn btn-success" id="submitBtn" disabled>
                            <span id="submitBtnText">Select a Plan First</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase and Dashboard Logic -->
    <script type="module">
        console.log('üìä MODERN DASHBOARD: Initializing with Firebase...');

        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut as firebaseSignOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
        import { getDatabase, ref, get, set, push, onValue, remove } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB8iFriCB3kt4lWeXQUNj5LTsAXFZoXX0Y",
            authDomain: "cartrace-pro.firebaseapp.com",
            databaseURL: "https://cartrace-pro-default-rtdb.firebaseio.com/",
            projectId: "cartrace-pro",
            storageBucket: "cartrace-pro.firebasestorage.app",
            messagingSenderId: "341907523496",
            appId: "1:341907523496:web:f10a87930d939cf3b8ff9d",
            measurementId: "G-X01QW112CD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        let currentUser = null;
        let userVehicles = [];

        // Check authentication
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('‚úÖ User authenticated:', user.email);
                currentUser = user;
                initializeDashboard(user);
            } else {
                console.log('‚ùå No user authenticated, redirecting to login...');
                window.location.href = 'auth.html';
            }
        });

        // Initialize Dashboard
        function initializeDashboard(user) {
            // Update user info in sidebar
            document.getElementById('sidebarUserInfo').innerHTML = `
                üë§ ${user.displayName || 'User'}<br>
                üìß ${user.email}
            `;

            // Update settings info
            document.getElementById('user-name').textContent = user.displayName || 'CarTrace User';
            document.getElementById('user-email').textContent = user.email;
            document.getElementById('member-since').textContent = new Date(user.metadata.creationTime).toLocaleDateString();

            // Load user data
            loadVehicles(user.uid);
            loadAlerts();
            startLiveUpdates();
        }

        // Load Vehicles
        async function loadVehicles(userId) {
            const vehiclesRef = ref(database, `vehicles/${userId}`);
            
            onValue(vehiclesRef, (snapshot) => {
                const vehiclesList = document.getElementById('vehicles-list');
                const vehicleStatus = document.getElementById('vehicle-status-content');
                
                if (snapshot.exists()) {
                    const vehicles = snapshot.val();
                    userVehicles = Object.entries(vehicles);
                    const vehicleCount = userVehicles.length;
                    
                    // Update counts across dashboard
                    document.getElementById('settings-vehicles').textContent = vehicleCount;
                    document.getElementById('analytics-vehicles').textContent = vehicleCount;
                    document.getElementById('total-vehicles-analytics').textContent = vehicleCount;
                    
                    // Calculate subscription analytics
                    let totalMonthlyRevenue = 0;
                    let activePlans = { BASIC: 0, GOLD: 0, PLATINUM: 0, DIAMOND: 0 };
                    
                    userVehicles.forEach(([id, v]) => {
                        if (v.planDetails) {
                            totalMonthlyRevenue += v.planDetails.price || 0;
                            if (v.protectionPlan) {
                                activePlans[v.protectionPlan]++;
                            }
                        }
                    });
                    
                    // Update analytics section
                    document.getElementById('analytics-active-vehicles').textContent = vehicleCount;
                    document.getElementById('analytics-monthly-revenue').textContent = totalMonthlyRevenue.toFixed(2);
                    
                    const planBreakdown = Object.entries(activePlans)
                        .filter(([plan, count]) => count > 0)
                        .map(([plan, count]) => `${plan}: ${count}`)
                        .join(', ') || 'None';
                    document.getElementById('analytics-plan-breakdown').textContent = planBreakdown;
                    
                    // Update vehicle status on dashboard
                    if (vehicleCount > 0) {
                        // Count vehicles by plan
                        let planCounts = { BASIC: 0, GOLD: 0, PLATINUM: 0, DIAMOND: 0 };
                        let totalMonthly = 0;
                        
                        userVehicles.forEach(([id, v]) => {
                            if (v.protectionPlan) {
                                planCounts[v.protectionPlan] = (planCounts[v.protectionPlan] || 0) + 1;
                                totalMonthly += v.planDetails?.price || 0;
                            }
                        });
                        
                        vehicleStatus.innerHTML = `
                            <div style="margin-bottom: 20px;">
                                <strong>‚úÖ ${vehicleCount} Vehicle${vehicleCount > 1 ? 's' : ''} Protected</strong>
                                ${totalMonthly > 0 ? `<br><span style="color: #6b7280; font-size: 14px;">Total monthly: ${totalMonthly.toFixed(2)}</span>` : ''}
                            </div>
                            <div class="stats-grid">
                                <div class="stat-box">
                                    <div class="stat-icon">üöó</div>
                                    <div class="stat-value">${vehicleCount}</div>
                                    <div class="stat-label">Total</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-icon">‚úÖ</div>
                                    <div class="stat-value">${vehicleCount}</div>
                                    <div class="stat-label">Active</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-icon">üõ°Ô∏è</div>
                                    <div class="stat-value">100%</div>
                                    <div class="stat-label">Protected</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-icon">üåê</div>
                                    <div class="stat-value">47K+</div>
                                    <div class="stat-label">Watchers</div>
                                </div>
                            </div>
                            ${Object.entries(planCounts).some(([plan, count]) => count > 0) ? `
                                <div style="margin-top: 15px; padding: 10px; background: #f3f4f6; border-radius: 8px; font-size: 12px;">
                                    <strong>Protection Plans:</strong><br>
                                    ${planCounts.BASIC > 0 ? `üü¢ Basic: ${planCounts.BASIC} vehicle${planCounts.BASIC > 1 ? 's' : ''}<br>` : ''}
                                    ${planCounts.GOLD > 0 ? `ü•á Gold: ${planCounts.GOLD} vehicle${planCounts.GOLD > 1 ? 's' : ''}<br>` : ''}
                                    ${planCounts.PLATINUM > 0 ? `üíé Platinum: ${planCounts.PLATINUM} vehicle${planCounts.PLATINUM > 1 ? 's' : ''}<br>` : ''}
                                    ${planCounts.DIAMOND > 0 ? `üí† Diamond: ${planCounts.DIAMOND} vehicle${planCounts.DIAMOND > 1 ? 's' : ''}<br>` : ''}
                                </div>
                            ` : ''}
                        `;
                        
                        // Show vehicles in vehicles section
                        vehiclesList.innerHTML = '';
                        userVehicles.forEach(([key, vehicle]) => {
                            const vehicleCard = document.createElement('div');
                            vehicleCard.className = 'vehicle-card';
                            
                            // Get plan badge color
                            const planColors = {
                                'BASIC': '#4CAF50',
                                'GOLD': '#FF9800',
                                'PLATINUM': '#9C27B0',
                                'DIAMOND': '#E91E63'
                            };
                            
                            vehicleCard.innerHTML = `
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="flex: 1;">
                                        <div class="vehicle-make">${vehicle.year || ''} ${vehicle.make} ${vehicle.model}</div>
                                        ${vehicle.protectionPlan ? `
                                            <div style="margin: 8px 0;">
                                                <span style="background: ${planColors[vehicle.protectionPlan]}; color: white; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: bold;">
                                                    ${vehicle.protectionPlan} ‚Ä¢ ${vehicle.planDetails?.coverageText || ''} ‚Ä¢ ${vehicle.planDetails?.price || '0'}/mo
                                                </span>
                                            </div>
                                        ` : ''}
                                        <div class="vehicle-details">
                                            <div><strong>Color:</strong> ${vehicle.color}</div>
                                            <div><strong>License Plate:</strong> ${vehicle.licensePlate}</div>
                                            ${vehicle.vin ? `<div><strong>VIN:</strong> ${vehicle.vin}</div>` : ''}
                                            ${vehicle.planDetails ? `
                                                <div style="margin-top: 8px; padding: 8px; background: #f3f4f6; border-radius: 6px;">
                                                    <strong style="color: #10b981;">üí∞ Community Reward:</strong> ${vehicle.planDetails.reward} for helpers<br>
                                                    <strong style="color: #4f46e5;">üìç Coverage Area:</strong> ${vehicle.planDetails.coverageText}
                                                </div>
                                            ` : ''}
                                        </div>
                                        ${vehicle.uniqueFeatures ? `
                                            <div style="margin-top: 10px; padding: 10px; background: #f3f4f6; border-radius: 8px;">
                                                <strong style="color: #4f46e5;">üåü Unique Features:</strong><br>
                                                <span style="color: #6b7280; font-size: 13px; white-space: pre-wrap;">${vehicle.uniqueFeatures}</span>
                                            </div>
                                        ` : ''}
                                        <span class="vehicle-status ${vehicle.status === 'STOLEN' ? 'status-stolen' : 'status-active'}">
                                            ${vehicle.status || 'ACTIVE'}
                                        </span>
                                    </div>
                                    <button class="btn btn-danger" onclick="deleteVehicle('${key}')" style="padding: 8px 16px; font-size: 12px;">
                                        üóëÔ∏è Remove
                                    </button>
                                </div>
                            `;
                            vehiclesList.appendChild(vehicleCard);
                        });
                    } else {
                        showEmptyVehicles(vehicleStatus);
                        showEmptyVehiclesList(vehiclesList);
                    }
                } else {
                    document.getElementById('settings-vehicles').textContent = '0';
                    document.getElementById('analytics-vehicles').textContent = '0';
                    document.getElementById('total-vehicles-analytics').textContent = '0';
                    
                    // Reset analytics
                    const analyticsActiveVehicles = document.getElementById('analytics-active-vehicles');
                    const analyticsMonthlyRevenue = document.getElementById('analytics-monthly-revenue');
                    const analyticsPlanBreakdown = document.getElementById('analytics-plan-breakdown');
                    
                    if (analyticsActiveVehicles) analyticsActiveVehicles.textContent = '0';
                    if (analyticsMonthlyRevenue) analyticsMonthlyRevenue.textContent = '0.00';
                    if (analyticsPlanBreakdown) analyticsPlanBreakdown.textContent = 'None';
                    
                    showEmptyVehicles(vehicleStatus);
                    showEmptyVehiclesList(vehiclesList);
                }
            });
        }

        // Load Alerts
        function loadAlerts() {
            const alertsRef = ref(database, 'stolenAlerts');
            onValue(alertsRef, (snapshot) => {
                const alertsList = document.getElementById('alerts-list');
                
                if (snapshot.exists()) {
                    const alerts = snapshot.val();
                    const activeAlerts = Object.values(alerts).filter(alert => alert.status === 'ACTIVE').length;
                    document.getElementById('active-alerts').textContent = activeAlerts;
                    
                    // Show recent alerts
                    alertsList.innerHTML = '';
                    const recentAlerts = Object.values(alerts).slice(-5).reverse();
                    
                    recentAlerts.forEach(alert => {
                        const alertDiv = document.createElement('div');
                        alertDiv.style = `background: ${alert.status === 'ACTIVE' ? '#fef2f2' : '#d1fae5'}; 
                                         padding: 15px; border-radius: 8px; margin-bottom: 10px; 
                                         border-left: 4px solid ${alert.status === 'ACTIVE' ? '#ef4444' : '#10b981'};`;
                        alertDiv.innerHTML = `
                            <strong>${alert.status === 'ACTIVE' ? 'üö®' : '‚úÖ'} ${alert.vehicleYear || ''} ${alert.vehicleMake} ${alert.vehicleModel}</strong>
                            ${alert.reward ? `<span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 10px; font-weight: bold;">üí∞ ${alert.reward} REWARD</span>` : ''}<br>
                            <small>License: ${alert.licensePlate} ‚Ä¢ Color: ${alert.color} ‚Ä¢ Coverage: ${alert.coverageText || '30 miles'} ‚Ä¢ ${new Date(alert.createdAt).toLocaleString()}</small>
                            ${alert.uniqueFeatures ? `<br><small style="color: #6b7280;">üåü ${alert.uniqueFeatures.substring(0, 100)}${alert.uniqueFeatures.length > 100 ? '...' : ''}</small>` : ''}
                        `;
                        alertsList.appendChild(alertDiv);
                    });
                } else {
                    document.getElementById('active-alerts').textContent = '0';
                    alertsList.innerHTML = `
                        <div style="background: #d1fae5; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #10b981;">
                            <strong>üü¢ Community Network Active</strong><br>
                            <small>All systems operational ‚Ä¢ No alerts at this time</small>
                        </div>
                    `;
                }
            });
        }

        // Show empty states
        function showEmptyVehicles(container) {
            container.innerHTML = `
                <p style="text-align: center; color: #6b7280; padding: 20px;">
                    <span style="font-size: 48px;">üöó</span><br>
                    Add your first vehicle to start community protection!
                </p>
                <button class="btn" onclick="showAddVehicleModal()" style="width: 100%;">
                    ‚ûï Add Vehicle
                </button>
            `;
        }

        function showEmptyVehiclesList(container) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">üöó</div>
                    <h3>No vehicles registered yet</h3>
                    <p>Add your first vehicle to get started with CarTrace Pro</p>
                    <button class="btn" onclick="showAddVehicleModal()" style="margin-top: 1rem;">Add Your First Vehicle</button>
                </div>
            `;
        }

        // Start live statistics updates
        function startLiveUpdates() {
            updateLiveStats();
            setInterval(updateLiveStats, 3000);
        }

        // Update live stats
        function updateLiveStats() {
            const uptime = (99.95 + Math.random() * 0.05).toFixed(2);
            document.getElementById('network-uptime').textContent = uptime + '%';
            
            const responseTime = (0.5 + Math.random() * 0.5).toFixed(1);
            document.getElementById('response-time').textContent = responseTime + 'ms';
            
            const securityScore = Math.floor(94 + Math.random() * 6);
            document.getElementById('security-score').textContent = securityScore;
            
            const dataPoints = Math.floor(1200 + Math.random() * 100);
            document.getElementById('data-points').textContent = dataPoints.toLocaleString();
            
            document.getElementById('last-update').textContent = 'just now';
        }

        // Global functions
        window.showSection = function(sectionId, linkElement) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Mark nav link as active
            if (linkElement) {
                linkElement.classList.add('active');
            }
            
            // Update header title
            const titles = {
                'dashboard': 'üõ°Ô∏è Security Dashboard',
                'vehicles': 'üöó My Vehicles',
                'recovery': 'üö® Community Recovery',
                'alerts': 'üîî Community Alerts',
                'analytics': 'üìà Analytics Center',
                'settings': '‚öôÔ∏è Settings & Profile'
            };
            
            document.getElementById('headerTitle').textContent = titles[sectionId] || 'üõ°Ô∏è Security Dashboard';
        };

        window.signOut = async function() {
            if (confirm('Are you sure you want to sign out?')) {
                try {
                    await firebaseSignOut(auth);
                    console.log('‚úÖ Signed out successfully');
                    window.location.href = 'auth.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Error signing out. Please try again.');
                }
            }
        };

        window.addVehicle = function() {
            showAddVehicleModal();
        };

        // Subscription plan data
        let selectedPlanData = null;
        let currentStep = 1;

        // Vehicle Data
        const vehicleDatabase = {
            'Toyota': ['Camry', 'Corolla', 'RAV4', 'Highlander', 'Tacoma', 'Tundra', 'Sienna', 'Prius', '4Runner', 'Avalon', 'C-HR', 'Venza', 'Sequoia', 'Land Cruiser'],
            'Honda': ['Accord', 'Civic', 'CR-V', 'Pilot', 'Odyssey', 'Ridgeline', 'HR-V', 'Passport', 'Insight', 'Fit', 'CR-Z', 'Clarity', 'Element'],
            'Ford': ['F-150', 'F-250', 'F-350', 'Mustang', 'Explorer', 'Escape', 'Edge', 'Expedition', 'Ranger', 'Bronco', 'Maverick', 'Focus', 'Fusion', 'Taurus', 'Fiesta'],
            'Chevrolet': ['Silverado', 'Equinox', 'Malibu', 'Traverse', 'Tahoe', 'Suburban', 'Colorado', 'Camaro', 'Corvette', 'Blazer', 'Trax', 'Bolt', 'Impala', 'Cruze', 'Spark'],
            'GMC': ['Sierra', 'Terrain', 'Acadia', 'Yukon', 'Canyon', 'Savana', 'Denali', 'Hummer EV'],
            'Jeep': ['Wrangler', 'Grand Cherokee', 'Cherokee', 'Compass', 'Renegade', 'Gladiator', 'Grand Wagoneer', 'Wagoneer', 'Patriot', 'Liberty'],
            'Ram': ['1500', '2500', '3500', 'ProMaster', 'ProMaster City'],
            'Nissan': ['Altima', 'Sentra', 'Rogue', 'Maxima', 'Murano', 'Pathfinder', 'Frontier', 'Titan', 'Versa', 'Kicks', 'Armada', 'Leaf', '370Z', 'GT-R'],
            'Hyundai': ['Elantra', 'Sonata', 'Tucson', 'Santa Fe', 'Palisade', 'Kona', 'Venue', 'Accent', 'Ioniq', 'Veloster', 'Genesis', 'Santa Cruz'],
            'Kia': ['Forte', 'Optima', 'K5', 'Sorento', 'Sportage', 'Telluride', 'Seltos', 'Soul', 'Rio', 'Stinger', 'Carnival', 'Niro', 'EV6'],
            'Mazda': ['Mazda3', 'Mazda6', 'CX-5', 'CX-9', 'CX-30', 'CX-50', 'MX-5 Miata', 'CX-3'],
            'Subaru': ['Outback', 'Forester', 'Crosstrek', 'Ascent', 'Impreza', 'Legacy', 'WRX', 'BRZ'],
            'Volkswagen': ['Jetta', 'Passat', 'Tiguan', 'Atlas', 'Golf', 'GTI', 'ID.4', 'Arteon', 'Taos'],
            'Mercedes-Benz': ['C-Class', 'E-Class', 'S-Class', 'GLE', 'GLC', 'GLA', 'GLB', 'G-Class', 'A-Class', 'CLA', 'CLS', 'EQS', 'AMG GT'],
            'BMW': ['3 Series', '5 Series', '7 Series', 'X3', 'X5', 'X7', 'X1', 'X2', 'X4', 'X6', '2 Series', '4 Series', '8 Series', 'M3', 'M5', 'i4', 'iX'],
            'Audi': ['A3', 'A4', 'A5', 'A6', 'A7', 'A8', 'Q3', 'Q5', 'Q7', 'Q8', 'e-tron', 'TT', 'R8'],
            'Lexus': ['IS', 'ES', 'GS', 'LS', 'NX', 'RX', 'GX', 'LX', 'UX', 'RC', 'LC'],
            'Acura': ['TLX', 'ILX', 'RDX', 'MDX', 'NSX', 'Integra'],
            'Infiniti': ['Q50', 'Q60', 'QX50', 'QX60', 'QX80', 'QX55'],
            'Cadillac': ['Escalade', 'XT4', 'XT5', 'XT6', 'CT4', 'CT5', 'Lyriq'],
            'Lincoln': ['Navigator', 'Aviator', 'Corsair', 'Nautilus', 'Continental', 'MKZ'],
            'Volvo': ['S60', 'S90', 'XC40', 'XC60', 'XC90', 'V60', 'V90', 'C40'],
            'Tesla': ['Model S', 'Model 3', 'Model X', 'Model Y', 'Cybertruck', 'Roadster'],
            'Porsche': ['911', 'Cayenne', 'Macan', 'Panamera', 'Taycan', '718 Cayman', '718 Boxster'],
            'Land Rover': ['Range Rover', 'Range Rover Sport', 'Range Rover Evoque', 'Discovery', 'Defender', 'Velar'],
            'Jaguar': ['XE', 'XF', 'XJ', 'F-Type', 'E-Pace', 'F-Pace', 'I-Pace'],
            'Chrysler': ['300', 'Pacifica', 'Voyager'],
            'Dodge': ['Challenger', 'Charger', 'Durango', 'Journey', 'Grand Caravan', 'Hornet'],
            'Buick': ['Enclave', 'Encore', 'Encore GX', 'Envision', 'LaCrosse', 'Regal'],
            'Genesis': ['G70', 'G80', 'G90', 'GV70', 'GV80', 'GV90'],
            'Mitsubishi': ['Outlander', 'Eclipse Cross', 'Outlander Sport', 'Mirage'],
            'Mini': ['Cooper', 'Countryman', 'Clubman', 'Paceman'],
            'Alfa Romeo': ['Giulia', 'Stelvio', 'Tonale'],
            'Fiat': ['500', '500X', '124 Spider'],
            'Maserati': ['Ghibli', 'Quattroporte', 'Levante', 'MC20', 'Grecale'],
            'Ferrari': ['488', 'F8 Tributo', 'SF90 Stradale', 'Roma', '812', 'Portofino'],
            'Lamborghini': ['Hurac√°n', 'Aventador', 'Urus'],
            'McLaren': ['570S', '720S', '765LT', 'GT', 'Artura'],
            'Aston Martin': ['Vantage', 'DB11', 'DBS', 'DBX'],
            'Bentley': ['Continental GT', 'Flying Spur', 'Bentayga'],
            'Rolls-Royce': ['Ghost', 'Phantom', 'Cullinan', 'Dawn', 'Wraith'],
            'Rivian': ['R1T', 'R1S'],
            'Lucid': ['Air'],
            'Polestar': ['Polestar 1', 'Polestar 2'],
            'Other': ['Custom/Other']
        };

        // Initialize the form dropdowns
        function initializeVehicleForm() {
            // Populate years (2000-2025)
            const yearSelect = document.getElementById('vehicleYear');
            yearSelect.innerHTML = '<option value="">Select Year</option>';
            for (let year = 2025; year >= 2000; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }

            // Populate makes
            const makeSelect = document.getElementById('vehicleMake');
            makeSelect.innerHTML = '<option value="">Select Make</option>';
            Object.keys(vehicleDatabase).sort().forEach(make => {
                const option = document.createElement('option');
                option.value = make;
                option.textContent = make;
                makeSelect.appendChild(option);
            });

            // Remove any existing event listeners
            const newMakeSelect = makeSelect.cloneNode(true);
            makeSelect.parentNode.replaceChild(newMakeSelect, makeSelect);
            
            // Handle make selection to populate models
            document.getElementById('vehicleMake').addEventListener('change', function() {
                const modelSelect = document.getElementById('vehicleModel');
                
                if (this.value) {
                    modelSelect.disabled = false;
                    modelSelect.innerHTML = '<option value="">Select Model</option>';
                    
                    const models = vehicleDatabase[this.value] || [];
                    models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model;
                        option.textContent = model;
                        modelSelect.appendChild(option);
                    });
                } else {
                    modelSelect.disabled = true;
                    modelSelect.innerHTML = '<option value="">Select Make First</option>';
                }
            });
        }

        // Show add vehicle modal
        window.showAddVehicleModal = function() {
            const modal = document.getElementById('addVehicleModal');
            modal.classList.add('active');
            currentStep = 1;
            selectedPlanData = null;
            updateStepIndicator();
            showFormSection('vehicleDetailsSection');
            initializeVehicleForm();
            
            // Reset plan selection
            document.querySelectorAll('.plan-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('selectedPlan').value = '';
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtnText').textContent = 'Select a Plan First';
        };

        // Close add vehicle modal
        window.closeAddVehicleModal = function() {
            const modal = document.getElementById('addVehicleModal');
            modal.classList.remove('active');
            document.getElementById('addVehicleForm').reset();
            currentStep = 1;
            selectedPlanData = null;
        };

        // Navigate between steps
        window.nextStep = function() {
            // Validate vehicle details first
            const year = document.getElementById('vehicleYear').value;
            const make = document.getElementById('vehicleMake').value;
            const model = document.getElementById('vehicleModel').value;
            const color = document.getElementById('vehicleColor').value;
            const licensePlate = document.getElementById('vehicleLicensePlate').value;

            if (!year || !make || !model || !color || !licensePlate) {
                alert('Please fill in all required vehicle details');
                return;
            }

            currentStep = 2;
            updateStepIndicator();
            showFormSection('protectionPlanSection');
        };

        window.previousStep = function() {
            currentStep = 1;
            updateStepIndicator();
            showFormSection('vehicleDetailsSection');
        };

        function updateStepIndicator() {
            document.getElementById('step1').classList.toggle('active', currentStep === 1);
            document.getElementById('step2').classList.toggle('active', currentStep === 2);
        }

        function showFormSection(sectionId) {
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Plan selection
        window.selectPlan = function(planId) {
            // Remove previous selection
            document.querySelectorAll('.plan-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked plan
            document.querySelector(`[data-plan="${planId}"]`).classList.add('selected');
            document.getElementById('selectedPlan').value = planId;
            
            // Store plan data
            const planDetails = {
                'BASIC': { name: 'Basic Protection', price: 5.99, reward: 200, coverage: 30, coverageText: '30 miles' },
                'GOLD': { name: 'Gold Protection', price: 9.99, reward: 300, coverage: 60, coverageText: '60 miles' },
                'PLATINUM': { name: 'Platinum Protection', price: 19.99, reward: 500, coverage: 100, coverageText: '100 miles' },
                'DIAMOND': { name: 'Diamond Protection', price: 29.99, reward: 750, coverage: -1, coverageText: 'Statewide' }
            };
            
            selectedPlanData = {
                planId: planId,
                ...planDetails[planId]
            };
            
            // Enable submit button and update text
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = false;
            submitBtn.innerHTML = `<span id="submitBtnText">üí≥ Add Vehicle with ${selectedPlanData.name} (${selectedPlanData.price}/mo)</span>`;
        };

        // Handle form submission
        document.getElementById('addVehicleForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!selectedPlanData) {
                alert('Please select a protection plan');
                return;
            }
            
            const submitBtn = e.target.querySelector('#submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="spinner" style="width: 16px; height: 16px; display: inline-block;"></span> Processing payment...';
            submitBtn.disabled = true;
            
            // Get form values
            const vehicleData = {
                year: document.getElementById('vehicleYear').value,
                make: document.getElementById('vehicleMake').value,
                model: document.getElementById('vehicleModel').value,
                color: document.getElementById('vehicleColor').value,
                licensePlate: document.getElementById('vehicleLicensePlate').value.toUpperCase(),
                vin: document.getElementById('vehicleVIN').value || '',
                uniqueFeatures: document.getElementById('vehicleFeatures').value || '',
                status: 'ACTIVE',
                protectionPlan: selectedPlanData.planId,
                planDetails: {
                    name: selectedPlanData.name,
                    price: selectedPlanData.price,
                    reward: selectedPlanData.reward,
                    coverage: selectedPlanData.coverage,
                    coverageText: selectedPlanData.coverageText
                },
                createdAt: Date.now(),
                lastUpdated: Date.now()
            };

            // Simulate payment processing
            setTimeout(async () => {
                try {
                    // Save to Firebase
                    const vehiclesRef = ref(database, `vehicles/${currentUser.uid}`);
                    const newVehicleRef = push(vehiclesRef);
                    
                    await set(newVehicleRef, vehicleData);
                    
                    // Save subscription data
                    const subscriptionData = {
                        userId: currentUser.uid,
                        vehicleId: newVehicleRef.key,
                        plan: selectedPlanData.planId,
                        planName: selectedPlanData.name,
                        price: selectedPlanData.price,
                        reward: selectedPlanData.reward,
                        coverageRadius: selectedPlanData.coverage,
                        coverageType: selectedPlanData.coverage === -1 ? 'statewide' : 'radius',
                        startDate: Date.now(),
                        status: 'active',
                        autoRenew: true
                    };
                    
                    const subscriptionRef = ref(database, `subscriptions/${currentUser.uid}/${newVehicleRef.key}`);
                    await set(subscriptionRef, subscriptionData);
                    
                    // Success
                    alert(`üéâ Success!\n\n‚úÖ ${vehicleData.year} ${vehicleData.make} ${vehicleData.model} added\nüí≥ ${selectedPlanData.name} activated (${selectedPlanData.price}/mo)\nüìç Coverage: ${selectedPlanData.coverageText}\nüí∞ Reward: ${selectedPlanData.reward} for helpers\n\nYour vehicle is now protected by 47,892 community members!`);
                    closeAddVehicleModal();
                    
                } catch (error) {
                    console.error('Error adding vehicle:', error);
                    alert('‚ùå Failed to add vehicle. Please try again.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            }, 2000); // Simulate payment processing time
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            const modal = document.getElementById('addVehicleModal');
            if (e.target === modal) {
                closeAddVehicleModal();
            }
        });

        window.deleteVehicle = async function(vehicleId) {
            if (confirm('Are you sure you want to remove this vehicle? This will also cancel its protection plan.')) {
                try {
                    // Remove vehicle
                    const vehicleRef = ref(database, `vehicles/${currentUser.uid}/${vehicleId}`);
                    await remove(vehicleRef);
                    
                    // Remove subscription
                    const subscriptionRef = ref(database, `subscriptions/${currentUser.uid}/${vehicleId}`);
                    await remove(subscriptionRef);
                    
                    alert('‚úÖ Vehicle and protection plan removed successfully');
                } catch (error) {
                    console.error('Error removing vehicle:', error);
                    alert('Failed to remove vehicle. Please try again.');
                }
            }
        };

        window.reportStolen = function() {
            const confirmed = confirm(`üö® COMMUNITY VEHICLE RECOVERY REPORT

This will immediately:
‚úÖ Alert community network (47,892 users)
‚úÖ Create crowdsourced search alert
‚úÖ Activate community reporting system
‚úÖ Send real-time updates to helpers
üí∞ Offer reward based on your protection plan

‚ö†Ô∏è Please ensure you have contacted local authorities (911) first.

üöß COMING SOON: Automatic GPS tracking, professional recovery teams, and insurance integration

Are you sure your vehicle is missing?`);
            
            if (confirmed) {
                // Find user's vehicles to report
                if (userVehicles.length === 0) {
                    alert('‚ùå Please add a vehicle first before reporting it as stolen.');
                    showSection('vehicles', document.querySelector('.nav-link'));
                    return;
                }
                
                // In a real app, this would show a selection dialog
                let vehicleIndex = 0;
                if (userVehicles.length > 1) {
                    const vehicleOptions = userVehicles.map(([id, v], i) => 
                        `${i + 1}. ${v.year || ''} ${v.make} ${v.model} (${v.color}, License: ${v.licensePlate})${v.protectionPlan ? `\n   üí∞ ${v.protectionPlan} Plan - ${v.planDetails?.reward || 200} reward, ${v.planDetails?.coverageText || '30 miles'} coverage` : ''}`
                    ).join('\n\n');
                    
                    const selection = prompt(`Which vehicle is missing?\n\n${vehicleOptions}\n\nEnter number (1-${userVehicles.length}):`);
                    vehicleIndex = parseInt(selection) - 1;
                }
                
                if (vehicleIndex >= 0 && vehicleIndex < userVehicles.length) {
                    const [vehicleId, vehicle] = userVehicles[vehicleIndex];
                    
                    // Create alert in database
                    const alertData = {
                        vehicleMake: vehicle.make,
                        vehicleModel: vehicle.model,
                        vehicleYear: vehicle.year || '',
                        color: vehicle.color,
                        licensePlate: vehicle.licensePlate,
                        vin: vehicle.vin || '',
                        uniqueFeatures: vehicle.uniqueFeatures || '',
                        protectionPlan: vehicle.protectionPlan || 'BASIC',
                        reward: vehicle.planDetails?.reward || 200,
                        coverageRadius: vehicle.planDetails?.coverage || 30,
                        coverageText: vehicle.planDetails?.coverageText || '30 miles',
                        reportedBy: currentUser.uid,
                        reporterEmail: currentUser.email,
                        status: 'ACTIVE',
                        createdAt: Date.now(),
                        caseId: `CVR-${Date.now()}`
                    };
                    
                    const alertsRef = ref(database, 'stolenAlerts');
                    push(alertsRef, alertData).then(() => {
                        alert(`üö® COMMUNITY RECOVERY ACTIVATED

‚úÖ Community network alerted (47,892 users)
‚úÖ Crowdsourced search initiated
‚úÖ Case ID: ${alertData.caseId}

üí∞ REWARD: ${alertData.reward} for successful recovery
üìç COVERAGE: ${alertData.coverageText} from theft location
üìß Confirmation email sent
üì± You will receive community updates

96.1% success rate via community assistance!`);
                    });
                    });
                }
            }
        };

        window.foundVehicle = function() {
            const licensePlate = prompt('Enter the license plate of the found vehicle:');
            if (licensePlate) {
                alert(`üîç COMMUNITY FOUND VEHICLE REPORT

License Plate: ${licensePlate}
Report ID: FVR-${Date.now()}

‚úÖ Report submitted to community network
‚úÖ Owner will be notified
‚úÖ Reward eligibility being processed

Thank you for helping the community!`);
            }
        };

        window.generateReport = function() {
            alert(`üìä COMMUNITY ANALYTICS REPORT

Report ID: RPT-${Date.now()}
Generated: ${new Date().toLocaleString()}

‚úÖ Community performance report created
‚úÖ Emailed to your registered address

The report includes:
‚Ä¢ Community network statistics
‚Ä¢ Recovery success metrics
‚Ä¢ Network activity analysis
‚Ä¢ Member participation insights

üöß Future: Advanced GPS analytics and professional recovery metrics coming soon!`);
        };
    </script>
</body>
</html>
